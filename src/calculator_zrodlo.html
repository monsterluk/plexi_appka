<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator PlexiSystem - Profesjonalny kalkulator cen</title>
    <link rel="shortcut icon" href="https://plexisystem.pl/wp-content/uploads/2025/04/cropped-plexi-bez-tla-e1748851554424.png" type="image/x-icon" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="dark-theme.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a192f;
            --bg-secondary: #172a45;
            --bg-card: #1e3a5f;
            --text-primary: #ccd6f6;
            --text-secondary: #8892b0;
            --accent: #ff6b35;
            --accent-hover: #ff8c5a;
            --border: #233554;
        }
        
        body {
            background: linear-gradient(135deg, #0a192f 0%, #172a45 100%);
            color: #ccd6f6;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            line-height: 1.6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }

        .calculator-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 12px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            backdrop-filter: blur(10px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            min-height: 75vh;
        }

        .form-section {
            padding: 30px;
            overflow-y: auto;
            max-height: 75vh;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }

        .results-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-left: 1px solid rgba(102, 126, 234, 0.1);
            position: sticky;
            top: 0;
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-group input:hover, .form-group select:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .product-options {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 14px;
            margin: 25px 0;
            border: 1px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .option-card {
            background: white;
            padding: 16px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .option-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .option-card:hover::before {
            transform: scaleX(1);
        }

        .option-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .option-card.selected::before {
            transform: scaleX(1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .results-card {
            background: white;
            padding: 20px;
            border-radius: 14px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
        }

        .price-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 14px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .price-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
            opacity: 0.3;
        }

        .price-display h3 {
            font-size: 1.9rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .price-display p {
            position: relative;
            z-index: 2;
            opacity: 0.9;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .section-title {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e9ecef;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .addon-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e1e5e9;
        }

        .addon-item input[type="number"] {
            width: 80px;
            padding: 6px 8px;
            margin: 0;
        }

        /* Ekspozytory buttons styles */
        .ekspozytory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .ekspozytor-button {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .ekspozytor-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .ekspozytor-button:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
        }

        .ekspozytor-button:hover::before {
            transform: scaleX(1);
        }

        .ekspozytor-button.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.25);
            transform: translateY(-3px);
        }

        .ekspozytor-button.selected::before {
            transform: scaleX(1);
        }

        .ekspozytor-button.selected::after {
            content: '✓';
            position: absolute;
            top: 15px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .ekspozytor-icon {
            width: 75px;
            height: 75px;
            margin: 0 auto 16px;
            border-radius: 14px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .ekspozytor-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .ekspozytor-button:hover .ekspozytor-icon::before,
        .ekspozytor-button.selected .ekspozytor-icon::before {
            opacity: 1;
        }

        .ekspozytor-icon i {
            font-size: 32px;
            color: #667eea;
            transition: all 0.4s ease;
            position: relative;
            z-index: 2;
        }

        .ekspozytor-button:hover .ekspozytor-icon i,
        .ekspozytor-button.selected .ekspozytor-icon i {
            color: white;
            transform: scale(1.1);
        }

        .ekspozytor-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        .ekspozytor-button:hover .ekspozytor-title,
        .ekspozytor-button.selected .ekspozytor-title {
            color: #667eea;
        }

        .ekspozytor-description {
            font-size: 0.85rem;
            color: #6c757d;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .ekspozytor-button:hover .ekspozytor-description {
            color: #495057;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-section {
                border-left: none;
                border-top: 1px solid #e1e5e9;
                position: static;
            }

            .ekspozytory-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .ekspozytory-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <div class="header-content">
                <div class="logo-container">
                    <img src="icons/logo.png" alt="PlexiSystem Logo" style="height: 60px; margin-right: 20px;">
                    <div>
                        <h1>Kalkulator PlexiSystem</h1>
                        <p>Profesjonalny kalkulator cen produktów z plexi i poliwęglanu</p>
                    </div>
                </div>
                <div style="position: absolute; top: 20px; right: 20px;">
                    <label style="color: white; font-size: 14px;">
                        <input type="checkbox" id="viewModeToggle" onchange="toggleViewMode()" checked>
                        Tryb kosztorysanta
                    </label>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 20px; justify-content: center; align-items: center; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; backdrop-filter: blur(10px);">
                        <i class="fas fa-tools" style="color: rgba(255,255,255,0.8);"></i>
                        <span style="font-size: 14px; font-weight: 500;">Ekspozytory</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; backdrop-filter: blur(10px);">
                        <i class="fas fa-layer-group" style="color: rgba(255,255,255,0.8);"></i>
                        <span style="font-size: 14px; font-weight: 500;">Kasety</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; backdrop-filter: blur(10px);">
                        <i class="fas fa-lightbulb" style="color: rgba(255,255,255,0.8);"></i>
                        <span style="font-size: 14px; font-weight: 500;">LEDON</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; backdrop-filter: blur(10px);">
                        <i class="fas fa-box" style="color: rgba(255,255,255,0.8);"></i>
                        <span style="font-size: 14px; font-weight: 500;">Pojemniki</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; backdrop-filter: blur(10px);">
                        <i class="fas fa-cash-register" style="color: rgba(255,255,255,0.8);"></i>
                        <span style="font-size: 14px; font-weight: 500;">Impuls kasowy</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="form-section">
                <form id="calculatorForm">
                    <!-- Product Type Selection -->
                    <div class="form-group">
                        <label for="productType">Rodzaj produktu</label>
                        <select id="productType" required onchange="updateProductOptions()">
                            <option value="">Wybierz rodzaj produktu</option>
                            <option value="plyta">Płyta standardowa</option>
                            <option value="kaseton">Kaseton reklamowy</option>
                            <option value="pojemnik">Pojemnik/Organizer</option>
                            <option value="gablota">Gablota</option>
                            <option value="obudowa">Obudowa/Osłona</option>
                            <option value="ledon">LEDON (Neon LED)</option>
                            <option value="ekspozytory">Ekspozytory</option>
                            <option value="impuls_kasowy">Impuls kasowy z plexi</option>
                        </select>
                    </div>

                    <!-- Product-specific options -->
                    <div id="productOptions" class="product-options" style="display: none;">
                        <!-- Dynamic content based on product type -->
                    </div>

                    <!-- Material Selection -->
                    <div class="form-group">
                        <label for="materialSelect">Materiał podstawowy</label>
                        <select id="materialSelect" required onchange="updateThickness()">
                            <option value="">Wybierz materiał</option>
                        </select>
                    </div>

                    <!-- Thickness -->
                    <div class="form-group">
                        <label for="thicknessSelect">Grubość materiału (mm)</label>
                        <select id="thicknessSelect" required onchange="calculatePrice()">
                            <option value="">Najpierw wybierz materiał</option>
                        </select>
                    </div>

                    <!-- Dimensions -->
                    <div class="section-title">Wymiary</div>
                    <div id="dimensionsContainer" class="dimensions-grid">
                        <div class="form-group">
                            <label for="width" id="widthLabel">Szerokość (mm)</label>
                            <input type="number" id="width" required min="1" placeholder="1000" oninput="calculatePrice()">
                        </div>
                        
                        <div class="form-group">
                            <label for="height" id="heightLabel">Wysokość (mm)</label>
                            <input type="number" id="height" required min="1" placeholder="500" oninput="calculatePrice()">
                        </div>
                        
                        <div class="form-group">
                            <label for="quantity" id="quantityLabel">Ilość (szt)</label>
                            <input type="number" id="quantity" required min="1" value="1" oninput="calculatePrice()">
                        </div>
                    </div>

                    <!-- Additional dimensions for 3D products -->
                    <div id="additionalDimensions" style="display: none;">
                        <div class="dimensions-grid">
                            <div class="form-group">
                                <label for="depth">Głębokość (mm)</label>
                                <input type="number" id="depth" min="1" placeholder="100" oninput="calculatePrice()">
                            </div>
                            
                            <div class="form-group" id="wallThicknessGroup">
                                <label for="wallThickness">Grubość ścianki (mm)</label>
                                <input type="number" id="wallThickness" min="1" placeholder="3" oninput="calculatePrice()">
                            </div>
                        </div>
                    </div>

                    <!-- Additional Services -->
                    <div class="section-title">Dodatkowe usługi</div>
                    <div id="addonsContainer">
                        <!-- Dynamic addons will be loaded here -->
                    </div>
                    
                    <!-- Salesperson Data Section -->
                    <div class="section-title">👔 Dane handlowca i oferty</div>
                    <div class="product-options">
                        <div class="dimensions-grid">
                            <div class="form-group">
                                <label for="salesperson_name">Handlowiec</label>
                                <select id="salesperson_name" required>
                                    <option value="">Wybierz handlowca</option>
                                    <option value="Dorota Będkowska">Dorota Będkowska</option>
                                    <option value="Łukasz Sikorra">Łukasz Sikorra</option>
                                    <option value="Marek Nowak">Marek Nowak</option>
                                    <option value="Anna Kowalska">Anna Kowalska</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="offer_date">Data oferty</label>
                                <input type="date" id="offer_date" value="" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label for="offer_number">Numer oferty</label>
                                <input type="text" id="offer_number" placeholder="PS-2025-000001" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Client Data Section -->
                    <div class="section-title">👤 Dane klienta</div>
                    <div class="product-options">
                        <div class="dimensions-grid">
                            <div class="form-group">
                                <label for="client_company">Nazwa firmy</label>
                                <input type="text" id="client_company" name="firma" required placeholder="Nazwa firmy klienta">
                            </div>
                            
                            <div class="form-group">
                                <label for="client_nip">NIP</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="client_nip" name="nip" placeholder="1234567890" pattern="[0-9]{10}" maxlength="10">
                                </div>
                            </div>
                        </div>
                        
                        <div class="dimensions-grid">
                            <div class="form-group">
                                <label for="client_address">Adres</label>
                                <input type="text" id="client_address" name="adres" placeholder="ul. Przykładowa 1">
                            </div>
                            
                            <div class="form-group">
                                <label for="client_postal_code">Kod pocztowy</label>
                                <input type="text" id="client_postal_code" name="kod_pocztowy" placeholder="00-000" pattern="[0-9]{2}-[0-9]{3}">
                            </div>
                            
                            <div class="form-group">
                                <label for="client_city">Miasto</label>
                                <input type="text" id="client_city" name="miasto" placeholder="Warszawa">
                            </div>
                        </div>
                        
                        <div class="dimensions-grid">
                            <div class="form-group">
                                <label for="client_phone">Telefon</label>
                                <input type="tel" id="client_phone" name="telefon" placeholder="+48 123 456 789">
                            </div>
                            
                            <div class="form-group">
                                <label for="client_email">Email</label>
                                <input type="email" id="client_email" name="email" placeholder="kontakt@firma.pl">
                            </div>
                            
                            <div class="form-group">
                                <label for="client_contact_person">Osoba kontaktowa</label>
                                <input type="text" id="client_contact_person" name="osoba_kontaktowa" placeholder="Jan Kowalski">
                            </div>
                        </div>
                    </div>

                    <!-- Logistics Section -->
                    <div class="section-title">📦 Logistyka i pakowanie</div>
                    <div class="product-options">
                        <div class="results-card" style="background: #e3f2fd; border-left: 4px solid #2196f3;">
                            <h4 style="color: #1976d2; margin-bottom: 15px;">Obliczenia logistyczne</h4>
                            <div class="dimensions-grid">
                                <div>
                                    <p><strong>Waga jednostkowa:</strong> <span id="unit_weight">0</span> kg</p>
                                    <p><strong>Waga całkowita:</strong> <span id="total_weight">0</span> kg</p>
                                </div>
                                <div>
                                    <p><strong>Objętość jednostkowa:</strong> <span id="unit_volume">0</span></p>
                                    <p><strong>Objętość całkowita:</strong> <span id="total_volume">0</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5 style="color: #667eea; margin-bottom: 15px;">Karton jednostkowy</h5>
                            <div class="option-card">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="unit_carton_checkbox" onchange="calculateUnitCarton()">
                                    <label for="unit_carton_checkbox">
                                        <strong>Dodaj karton jednostkowy FEFCO 0201</strong><br>
                                        <small style="color: #666;">8 zł/m² tektury</small>
                                    </label>
                                </div>
                                <div id="unit_carton_details" style="display: none; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <p style="margin: 5px 0;"><strong>Powierzchnia tektury:</strong> <span id="carton_surface">0</span> m²</p>
                                    <p style="margin: 5px 0;"><strong>Koszt kartonu:</strong> <span id="carton_cost">0</span> zł/szt</p>
                                    <p style="margin: 5px 0;"><strong>Koszt wszystkich kartonów:</strong> <span id="total_carton_cost">0</span> zł</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5 style="color: #667eea; margin-bottom: 15px;">Sposób pakowania</h5>
                            <div class="options-grid">
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="pack_unit" name="packaging_type" value="unit_box" checked onchange="calculateLogistics()">
                                        <label for="pack_unit">
                                            <strong>Karton jednostkowy</strong><br>
                                            <small style="color: #666;">35 zł/szt</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="pack_collective" name="packaging_type" value="collective_box" onchange="calculateLogistics()">
                                        <label for="pack_collective">
                                            <strong>Karton zbiorczy</strong><br>
                                            <small style="color: #666;">35 zł/m²</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="pack_pallet" name="packaging_type" value="pallet" onchange="calculateLogistics()">
                                        <label for="pack_pallet">
                                            <strong>Paleta</strong><br>
                                            <small style="color: #666;">200-300 zł</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5 style="color: #667eea; margin-bottom: 15px;">Sposób dostawy</h5>
                            <div class="options-grid">
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="delivery_courier" name="delivery_type" value="courier" checked onchange="calculateLogistics()">
                                        <label for="delivery_courier">
                                            <strong>Kurier</strong><br>
                                            <small style="color: #666;">Wliczony w pakowanie</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="delivery_city" name="delivery_type" value="own_delivery_city" onchange="calculateLogistics()">
                                        <label for="delivery_city">
                                            <strong>Dostawa własna (Trójmiasto)</strong><br>
                                            <small style="color: #666;">50 zł</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="delivery_100km" name="delivery_type" value="own_delivery_100km" onchange="calculateLogistics()">
                                        <label for="delivery_100km">
                                            <strong>Dostawa własna do 100km</strong><br>
                                            <small style="color: #666;">200 zł</small>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="option-card">
                                    <div class="checkbox-group">
                                        <input type="radio" id="delivery_pickup" name="delivery_type" value="personal_pickup" onchange="calculateLogistics()">
                                        <label for="delivery_pickup">
                                            <strong>Odbiór osobisty</strong><br>
                                            <small style="color: #666;">0 zł</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-card" style="margin-top: 20px; background: #fff3e0;">
                            <h5 style="color: #f57c00; margin-bottom: 15px;">Podsumowanie pakowania</h5>
                            <div id="packaging_summary">
                                <p><strong>Liczba kartonów:</strong> <span id="box_count">0</span> szt</p>
                                <p><strong>Liczba palet:</strong> <span id="pallet_count">0</span> szt</p>
                                <p><strong>Koszt pakowania:</strong> <span id="packaging_cost">0</span> zł</p>
                                <p><strong>Koszt dostawy:</strong> <span id="delivery_cost">0</span> zł</p>
                                <p style="font-weight: bold; color: #f57c00; margin-top: 10px;">
                                    <strong>Łączny koszt logistyki:</strong> <span id="total_logistics_cost">0</span> zł
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Comment Section -->
                    <div class="section-title">💬 Notatki i opis oferty</div>
                    <div class="form-group">
                        <label for="handlowiec_comment">Komentarz handlowca (widoczny dla klienta)</label>
                        <textarea id="handlowiec_comment" rows="4" 
                                  style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; resize: vertical;"
                                  placeholder="Dodatkowe informacje, uwagi techniczne, terminy realizacji..."></textarea>
                        <small style="color: #666; font-size: 12px;">Ten komentarz pojawi się w ofercie PDF dla klienta</small>
                    </div>
                </form>
            </div>

            <div class="results-section">
                <div class="results-card">
                    <h3><i class="fas fa-info-circle"></i> Szczegóły kalkulacji</h3>
                    <div id="calculationDetails">
                        <p><strong>Powierzchnia:</strong> <span id="surfaceArea">0</span> m²</p>
                        <p id="wasteInfo" style="display: none; color: #667eea;"><strong>Odpad produkcyjny:</strong> <span id="wasteAmount">0</span> mm</p>
                        <p id="thicknessInfo" style="display: none; color: #667eea;"><strong>Grubość materiału:</strong> <span id="thicknessValue">0</span> mm</p>
                        <p id="ledInfo" style="display: none; color: #667eea;"><strong>Ilość LEDów:</strong> <span id="ledQuantity">0</span> szt</p>
                        <p id="weightInfo" style="display: none; color: #667eea;"><strong>Waga:</strong> <span id="weightValue">0</span> kg</p>
                                                <p><strong>Koszt materiału:</strong> <span id="materialCost">0</span> zł</p>
                        <p><strong>Koszt dodatków:</strong> <span id="addonsCost">0</span> zł</p>
                        <p><strong>Koszt opcji:</strong> <span id="optionsCost">0</span> zł</p>
                    </div>
                </div>

                <div class="price-display">
                    <h3><span id="totalPrice">0</span> zł</h3>
                    <p>Cena netto</p>
                    <hr style="margin: 15px 0; opacity: 0.3;">
                    <h3><span id="totalPriceBrutto">0</span> zł</h3>
                    <p>Cena brutto (VAT 23%)</p>
                </div>

                <div style="margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveCalculation()">
                        <i class="fas fa-save"></i> Zapisz ofertę
                    </button>
                    <button type="button" class="btn" onclick="saveDraft()" style="background: #f39c12;">
                        <i class="fas fa-file-alt"></i> Zapisz kopię roboczą
                    </button>
                    <button type="button" class="btn" onclick="saveAndSend()" style="background: #3498db;">
                        <i class="fas fa-paper-plane"></i> Zapisz i wyślij
                    </button>
                    <button type="button" class="btn" onclick="printCalculation()" style="background: #2ed573;">
                        <i class="fas fa-print"></i> Drukuj ofertę
                    </button>
                    <button type="button" class="btn" onclick="window.location.href='quotations-panel.html'" style="background: #9b59b6;">
                        <i class="fas fa-list"></i> Historia ofert
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Kontener dla formularza logistyki -->
    <div id="logistics-root"></div>

    <!-- Skrypt formularza logistyki -->
    <script src="./LogisticsFormExtended.js"></script>
    
    <!-- Integracja z GUS API -->
    <script src="./gus-integration.js"></script>

    <script>
        // Global variables
        let materials = [];
        let addons = [];
        let productOptions = {};
        let selectedEkspozytorType = null;
        let currentCalculation = {
            productCost: 0,
            logisticsCost: 0,
            totalCost: 0
        };
        
        // Material densities (kg/m³)
        const MATERIAL_DENSITIES = {
            'PET-G': 1270,
            'Plexi': 1190,
            'Poliwęglan': 1200,
            'Dibond': 1500,
            'default': 1200
        };
        
        // Packaging constants
        const CARDBOARD_THICKNESS = 10; // mm
        const PALLET_DIMENSIONS = { width: 800, length: 1200, maxHeight: 1800 }; // mm
        const PACKAGING_PRICES = {
            'unit_box': 35, // zł/szt
            'collective_box': 35, // zł/m²
            'pallet': { under30kg: 200, over30kg: 300 }
        };
        const DELIVERY_PRICES = {
            'courier': 0,
            'own_delivery_city': 50,
            'own_delivery_100km': 200,
            'personal_pickup': 0
        };
        
        // Cennik gięcia na gorąco wg grubości
        const bendingPrices = {
            1.5: 2,
            2: 4,
            3: 5,
            4: 7,
            5: 10,
            6: 20,
            8: 40,
            10: 80,
            12: 100,
            15: 125,
            20: 155
        };

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', async function() {
            await loadData();
            setupEventListeners();
            initializeOfferData();
            console.log('Calculator initialized with productOptions:', productOptions);
        });
        
        // Initialize offer data
        function initializeOfferData() {
            // Set current date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('offer_date').value = today;
            
            // Generate offer number
            const year = new Date().getFullYear();
            const month = String(new Date().getMonth() + 1).padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(5, '0');
            const offerNumber = `PS-${year}${month}-${random}`;
            document.getElementById('offer_number').value = offerNumber;
            
            // Set default salesperson from localStorage or logged user
            const savedSalesperson = localStorage.getItem('salesperson_name');
            if (savedSalesperson) {
                document.getElementById('salesperson_name').value = savedSalesperson;
            }
        }

        async function loadData() {
            // Mock data - replace with actual API calls
            materials = [
                {id: 1, nazwa: 'PET-G / Plexi bezbarwna', cena_za_m2: 30, wspolczynnik_trudnosci: 1.19, dostepne_grubosci: [1,2,3,4,5,6,8,10,12,15,20]},
                {id: 2, nazwa: 'PET-G / Plexi mleczna', cena_za_m2: 32, wspolczynnik_trudnosci: 1.19, dostepne_grubosci: [1,2,3,4,5,6,8,10,12,15,20]},
                {id: 3, nazwa: 'PET-G / Plexi kolorowa', cena_za_m2: 35, wspolczynnik_trudnosci: 1.25, dostepne_grubosci: [1,2,3,4,5,6,8,10,12,15,20]},
                {id: 4, nazwa: 'Poliwęglan bezbarwny', cena_za_m2: 45, wspolczynnik_trudnosci: 1.30, dostepne_grubosci: [2,3,4,5,6,8,10,12,15,20]},
                {id: 5, nazwa: 'Poliwęglan mleczny', cena_za_m2: 47, wspolczynnik_trudnosci: 1.30, dostepne_grubosci: [2,3,4,5,6,8,10,12,15,20]},
                {id: 6, nazwa: 'Dibond', cena_za_m2: 55, wspolczynnik_trudnosci: 1.40, dostepne_grubosci: [3,4,6]}
            ];

            addons = [
                {id: 1, nazwa: 'Wiercenie otworów', typ: 'obrobka', cena: 2.00, jednostka: 'otwory'},
                {id: 2, nazwa: 'Fazowanie krawędzi', typ: 'obrobka', cena: 6.00, jednostka: 'mb', minPrice: 6.00},
                {id: 3, nazwa: 'Polerowanie krawędzi', typ: 'obrobka', cena: 9.00, jednostka: 'mb', minPrice: 9.00},
                {id: 8, nazwa: 'Grafika latex', typ: 'druk', cena: 75.00, jednostka: 'm2'},
                {id: 9, nazwa: 'Grawerowanie', typ: 'obrobka', cena: 100.00, jednostka: 'godz'}
            ];

            // Product-specific options with pricing
            productOptions = {
                kaseton: {
                    types: [
                        {id: 'kaseton_plexi', name: 'Kaseton z plexi', price: 1550, unit: 'm2'},
                        {id: 'kaseton_dibond', name: 'Kaseton z dibond', price: 1400, unit: 'm2'}
                    ],
                    letters: [
                        {id: 'litery_podklejone', name: 'Litery podklejane', price: 0, unit: 'm2'},
                        {id: 'litery_zlicowane', name: 'Litery zlicowane', price: 150, unit: 'm2'},
                        {id: 'litery_wystajace', name: 'Litery wystające', price: 400, unit: 'm2'},
                        {id: 'litery_halo', name: 'Litery z efektem Halo', price: 300, unit: 'm2'}
                    ]
                },
                pojemnik: {
                    hardware: [
                        {id: 'zawiasy_bezbarwne', name: 'Zawias bezbarwny', price: 7, unit: 'szt'},
                        {id: 'zawiasy_nierdzewne', name: 'Zawias nierdzewny', price: 9, unit: 'szt'},
                        {id: 'zamek', name: 'Zamek', price: 11, unit: 'szt'}
                    ],
                    przegrody: [
                        {id: 'przegrody_proste', name: 'Przegrody proste', price: 0, unit: 'szt', customizable: true},
                        {id: 'przegrody_kratownica', name: 'Przegrody kratownica', price: 0, unit: 'szt', customizable: true}
                    ],
                    klapka: [
                        {id: 'klapka_skosna', name: 'Klapka skośna (trapez)', price: 0, unit: 'szt', diagonal: true}
                    ]
                },
                gablota: {
                    podstawa: [
                        {id: 'podstawa_standard', name: 'Podstawa standardowa (ten sam materiał)', price: 0, unit: 'm2'},
                        {id: 'podstawa_inna', name: 'Podstawa z innego materiału/grubości', price: 0, unit: 'm2', customizable: true}
                    ]
                },
                ledon: {
                    plexi_type: [
                        {id: 'plexi_bezbarwna', name: 'Plexi bezbarwna', price: 30, unit: 'm2'},
                        {id: 'plexi_mleczna', name: 'Plexi mleczna', price: 32, unit: 'm2'},
                        {id: 'plexi_czarna', name: 'Plexi czarna', price: 35, unit: 'm2'}
                    ],
                    led_type: [
                        {id: 'led_standard', name: 'Taśma LED standardowa', price: 30, unit: 'm'},
                        {id: 'led_neonflex', name: 'Neonflex COB', price: 70, unit: 'm'}
                    ],
                    options: [
                        {id: 'projekt_brak', name: 'Projekt graficzny - brak', price: 0, unit: 'szt'},
                        {id: 'projekt_skomplikowany', name: 'Projekt graficzny - skomplikowany', price: 300, unit: 'szt'},
                        {id: 'rgb', name: 'RGB', price: 150, unit: 'szt'},
                        {id: 'wodoodpornosc', name: 'Wodoodporność IP65 (+20%)', price: 0, unit: 'szt', percentage: 20},
                        {id: 'montaz_zasilacz', name: 'Montaż + zasilacz', price: 150, unit: 'szt'}
                    ]
                },
                ekspozytor: {
                    types: [
                        {
                            id: 'podstawkowy', 
                            name: 'Ekspozytor podstawkowy', 
                            multiplier: 2.2, 
                            components: ['podstawa', 'scianka_tylna', 'boki_opcjonalne', 'laczniki_opcjonalne'],
                            description: 'Podstawa – płaska płyta plexi, na której stoi ekspozytor. Ścianka tylna – pionowa płyta plexi, przymocowana do podstawy, często pod kątem prostym. Boki (opcjonalnie) – krótkie ścianki boczne, które zwiększają stabilność i chronią produkt przed spadnięciem. Łączniki (opcjonalnie) – kątowniki, zaciski lub klej, które łączą podstawę ze ścianką tylną i bokami.',
                            dimensions_required: ['width', 'depth', 'back_height'],
                            graphics_options: true,
                            elements: {
                                podstawa: 1, // szerokość × głębokość
                                scianka_tylna: 1, // szerokość × wysokość_tylnej
                                boki: 0, // opcjonalne - głębokość × wysokość_tylnej × 2
                                laczniki: 0 // opcjonalne
                            }
                        },
                        {
                            id: 'schodkowy', 
                            name: 'Ekspozytor schodkowy (kaskadowy)', 
                            multiplier: 2.5, 
                            components: ['podstawa', 'poziomy_min_2', 'boki', 'plecy_opcjonalne'],
                            description: 'Podstawa – dolna płyta plexi, na której opiera się cała konstrukcja. Poziomy (min. 2) – półki lub stopnie ułożone jeden nad drugim, przymocowane do podstawy lub do boków. Boki – pionowe ścianki boczne, które łączą podstawę z poziomami i zwiększają stabilność. Plecy (opcjonalnie) – pionowa płyta plexi, przymocowana z tyłu ekspozytora, dodatkowo stabilizująca konstrukcję.',
                            dimensions_required: ['width', 'depth', 'height', 'levels_count'],
                            graphics_options: true,
                            elements: {
                                podstawa: 1, // szerokość × głębokość
                                poziomy: 2, // minimum 2, szerokość × głębokość × ilość
                                boki: 2, // głębokość × wysokość × 2
                                plecy: 0 // opcjonalne - szerokość × wysokość
                            }
                        },
                        {
                            id: 'z_haczykami', 
                            name: 'Ekspozytor z haczykami', 
                            multiplier: 2.4, 
                            components: ['plyta_tylna', 'haczyki', 'boki_opcjonalne', 'podstawa_opcjonalna'],
                            description: 'Płyta tylna – pionowa płyta plexi, na której montuje się haczyki. Haczyki – metalowe lub plastikowe elementy, włożone w otwory w płycie tylnej, służące do zawieszania produktów. Boki (opcjonalnie) – ścianki boczne, zwiększające stabilność. Ich wymiar to głębokość podstawy x wysokość. Podstawa (opcjonalnie) – płaska płyta plexi pod spodem, jeśli ekspozytor ma stać na blacie.',
                            dimensions_required: ['width', 'height', 'depth_optional'],
                            graphics_options: true,
                            elements: {
                                plyta_tylna: 1, // szerokość × wysokość
                                haczyki: 0, // ilość haczyków
                                boki: 0, // opcjonalne - głębokość × wysokość × 2
                                podstawa: 0 // opcjonalne - szerokość × głębokość
                            }
                        },
                        {
                            id: 'wiszacy', 
                            name: 'Ekspozytor wiszący', 
                            multiplier: 2.2, 
                            components: ['plyta_tylna', 'polki_kieszenie', 'boki_opcjonalne', 'zawiesie'],
                            description: 'Płyta tylna – pionowa płyta plexi, która mocuje się do ściany lub regału. Półki lub kieszenie – poziome elementy plexi, przymocowane do płyty tylnej, służące do kładzenia produktów. Boki (opcjonalnie) – krótkie ścianki boczne, które stabilizują półki lub kieszenie. Zawiesie – uchwyty, haczyki lub magnesy do montażu ekspozytora na ścianie.',
                            dimensions_required: ['width', 'height', 'depth', 'shelves_count'],
                            graphics_options: true,
                            elements: {
                                plyta_tylna: 1, // szerokość × wysokość
                                polki_kieszenie: 1, // szerokość × głębokość × ilo��ć
                                boki: 0, // opcjonalne - głębokość × wysokość × 2
                                zawiesie: 1 // system zawieszenia
                            }
                        },
                        {
                            id: 'stojak', 
                            name: 'Ekspozytor stojak', 
                            multiplier: 2.5, 
                            components: ['podstawa', 'plecy', 'polki_opcjonalne', 'boki'],
                            description: 'Podstawa – płaska płyta plexi, na której stoi ekspozytor. Plecy – pionowa płyta plexi, przymocowana do podstawy. Półki (opcjonalnie) – poziome płyty plexi, przymocowane do pleców. Boki – pionowe ścianki boczne, które łączą podstawę z plecami i półkami.',
                            dimensions_required: ['width', 'depth', 'height', 'shelves_count_optional'],
                            graphics_options: true,
                            elements: {
                                podstawa: 1, // szerokość × głębokość
                                plecy: 1, // szerokość × wysokość
                                boki: 2, // głębokość × wysokość × 2
                                polki: 0 // opcjonalne - szerokość × głębokość × ilość
                            }
                        },
                        {
                            id: 'kosmetyczny', 
                            name: 'Ekspozytor kosmetyczny', 
                            multiplier: 2.7, 
                            components: ['podstawa', 'drugie_dno_opcjonalne', 'boki', 'plecy', 'plyta_z_otworami', 'topper_opcjonalny'],
                            description: 'Podstawa – dolna płyta plexi, na której stoi ekspozytor. Drugie dno (opcjonalnie) – dodatkowa płyta plexi, tworząca dodatkowy poziom. Boki – pionowe ścianki boczne, które łączą podstawę, drugie dno i plecy. Plecy – tylna płyta plexi, przymocowana do boków i podstawy. Płyta z otworami – górna lub przednia płyta plexi z wyciętymi otworami na produkty. Topper (opcjonalnie) – dekoracyjna płyta plexi na górze ekspozytora.',
                            dimensions_required: ['width', 'depth', 'height', 'holes_count'],
                            graphics_options: true,
                            has_topper: true,
                            elements: {
                                podstawa: 1, // szerokość × głębokość
                                drugie_dno: 0, // opcjonalne - szerokość × głębokość
                                boki: 2, // głębokość × wysokość × 2
                                plecy: 1, // szerokość × wysokość
                                plyta_z_otworami: 1, // szerokość × głębokość
                                topper: 0 // opcjonalne - szerokość × głębokość
                            }
                        }
                    ],
                    plexi_types: [
                        {id: 'bezbarwna', name: 'Bezbarwna', price: 30, unit: 'm2', density: 1.19, per_mm: true},
                        {id: 'mleczna_czarna_biala', name: 'Mleczna / czarna / biała (+10%)', price: 33, unit: 'm2', density: 1.19, per_mm: true},
                        {id: 'kolorowa_3mm', name: 'Kolorowa 3 mm', price: 120, unit: 'm2', thickness: 3, density: 1.19, fixed_thickness: true},
                        {id: 'kolorowa_5mm', name: 'Kolorowa 5 mm', price: 200, unit: 'm2', thickness: 5, density: 1.19, fixed_thickness: true}
                    ],
                    thickness_options: [2, 3, 4, 5],
                    additional_options: [
                        {id: 'zamykany', name: 'Zamykany ekspozytor', price: 10, unit: 'szt', no_multiplier: true, integer_only: true},
                        {id: 'podswietlenie_led', name: 'Podświetlenie LED', price: 120, unit: 'szt', no_multiplier: true, integer_only: true},
                        {id: 'z_grafika', name: 'Z grafiką', price: 0, unit: 'szt', no_multiplier: true, note: 'Bez dopłaty domyślnie, grafika liczona tylko przy topperze'},
                        {id: 'karton_jednostkowy', name: 'Karton jednostkowy', price: 8, unit: 'm2', no_multiplier: true},
                        {id: 'polerowanie_krawedzi', name: 'Polerowanie krawędzi', price: 5, unit: 'mb', no_multiplier: true},
                        {id: 'polki', name: 'Półki', price: 0, unit: 'szt', auto_price: true, integer_only: true},
                        {id: 'przegrody', name: 'Przegrody', price: 0, unit: 'szt', auto_price: true, for_cosmetic: true, integer_only: true},
                        {id: 'haczyki', name: 'Haczyki', price: 4, unit: 'szt', no_multiplier: true, quantity_input: true, integer_only: true}
                    ]
                },
                impuls_kasowy: {
                    plexi_types: [
                        {id: 'bezbarwna', name: 'Plexi bezbarwna', price: 30, unit: 'm2', density: 1.19, per_mm: true},
                        {id: 'biala', name: 'Plexi biała (+10%)', price: 33, unit: 'm2', density: 1.19, per_mm: true}
                    ],
                    thickness_options: [2, 3, 4, 5, 6, 8, 10, 12, 15, 20],
                    multiplier: 1.8,
                    min_shelves: 2,
                    shelf_limiter_height: 60, // mm
                    additional_options: [
                        {id: 'grafika_jednostronna', name: 'Grafika jednostronna na plecy', price: 75, unit: 'm2', no_multiplier: true},
                        {id: 'grafika_dwustronna', name: 'Grafika dwustronna na plecy', price: 150, unit: 'm2', no_multiplier: true}
                    ]
                }
            };

            populateMaterials();
            populateAddons();
        }

        function populateMaterials() {
            const select = document.getElementById('materialSelect');
            select.innerHTML = '<option value="">Wybierz materiał</option>';
            
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.nazwa} (${material.cena_za_m2} zł/m²)`;
                option.setAttribute('data-price', material.cena_za_m2);
                option.setAttribute('data-difficulty', material.wspolczynnik_trudnosci);
                option.setAttribute('data-thickness', material.dostepne_grubosci.join(','));
                select.appendChild(option);
            });
        }

        function populateAddons() {
            const container = document.getElementById('addonsContainer');
            const addonsByType = {};
            
            addons.forEach(addon => {
                if (!addonsByType[addon.typ]) {
                    addonsByType[addon.typ] = [];
                }
                addonsByType[addon.typ].push(addon);
            });

            container.innerHTML = '';
            Object.keys(addonsByType).forEach(type => {
                const typeDiv = document.createElement('div');
                typeDiv.innerHTML = `
                    <h4 style="color: #667eea; margin-bottom: 10px; text-transform: capitalize;">
                        ${type.replace('_', ' ')}
                    </h4>
                `;
                
                addonsByType[type].forEach(addon => {
                    const addonDiv = document.createElement('div');
                    addonDiv.className = 'addon-item';
                    
                    let priceText = '';
                    let extraInput = '';
                    
                    if (addon.priceByThickness) {
                        priceText = 'Cena zależna od grubości';
                    } else if (addon.jednostka === 'godz') {
                        priceText = `${addon.cena} zł/${addon.jednostka}`;
                        extraInput = `
                            <input type="number" id="addon_time_${addon.id}" min="0" value="0" step="0.1"
                                   placeholder="Czas (godz)" onchange="calculatePrice()" style="width: 80px; margin-left: 5px;">
                        `;
                    } else if (addon.jednostka === 'otwory') {
                        priceText = `${addon.cena} zł/otwór × ilość sztuk`;
                    } else {
                        priceText = `${addon.cena} zł/${addon.jednostka}`;
                        if (addon.minPrice) {
                            priceText += ` (min. ${addon.minPrice} zł)`;
                        }
                    }
                    
                    // Determine step and placeholder for addons
                    let step = '0.1'; // Default for measurements (mb, m2)
                    let placeholder = 'Ilość';
                    
                    if (addon.jednostka === 'szt' || addon.jednostka === 'otwory' || addon.jednostka === 'godz') {
                        step = '1'; // Pełne wartości dla sztuk, otworów, godzin
                        placeholder = addon.jednostka === 'godz' ? 'Godziny' : 'Sztuki';
                    }
                    
                    addonDiv.innerHTML = `
                        <input type="checkbox" id="addon_${addon.id}" value="${addon.id}" 
                               data-price="${addon.cena}" data-unit="${addon.jednostka}" onchange="calculatePrice()">
                        <label for="addon_${addon.id}" style="flex: 1;">
                            <strong>${addon.nazwa}</strong><br>
                            <small style="color: #666;">${priceText}</small>
                        </label>
                        <input type="number" id="addon_qty_${addon.id}" min="0" value="0" step="${step}"
                               placeholder="${placeholder}" onchange="calculatePrice()">
                        <small style="color: #666;">${addon.jednostka}</small>
                        ${extraInput}
                    `;
                    typeDiv.appendChild(addonDiv);
                });
                
                container.appendChild(typeDiv);
            });
        }

        function updateProductOptions() {
            const productType = document.getElementById('productType').value;
            const optionsContainer = document.getElementById('productOptions');
            const additionalDimensions = document.getElementById('additionalDimensions');
            const materialSection = document.getElementById('materialSelect').closest('.form-group');
            const thicknessSection = document.getElementById('thicknessSelect').closest('.form-group');
            const addonsContainer = document.getElementById('addonsContainer').closest('div');
            const wallThicknessGroup = document.getElementById('wallThicknessGroup');
            const dimensionsContainer = document.getElementById('dimensionsContainer');
            
            if (!productType) {
                optionsContainer.style.display = 'none';
                additionalDimensions.style.display = 'none';
                materialSection.style.display = 'block';
                thicknessSection.style.display = 'block';
                addonsContainer.style.display = 'block';
                return;
            }

            // Special handling for kaseton, ledon, ekspozytor, ekspozytory, and impuls_kasowy - hide materials, thickness, and addons
            if (productType === 'kaseton' || productType === 'ledon' || productType === 'ekspozytor' || productType === 'ekspozytory' || productType === 'impuls_kasowy') {
                materialSection.style.display = 'none';
                thicknessSection.style.display = 'none';
                addonsContainer.style.display = 'none';
                additionalDimensions.style.display = 'none';
                
                // For impuls_kasowy, also hide standard dimensions since it has its own
                if (productType === 'impuls_kasowy') {
                    dimensionsContainer.style.display = 'none';
                }
                
                // Set default values
                document.getElementById('materialSelect').value = '';
                document.getElementById('thicknessSelect').value = '';
                document.getElementById('depth').value = '';
                
                // Update labels for LEDON
                if (productType === 'ledon') {
                    document.getElementById('widthLabel').textContent = 'Długość plexi (mm)';
                    document.getElementById('heightLabel').textContent = 'Szerokość plexi (mm)';
                    document.getElementById('quantityLabel').textContent = 'Grubość plexi (mm)';
                    document.getElementById('quantity').value = '3'; // Default 3mm thickness
                } else {
                    // Reset labels for kaseton
                    document.getElementById('widthLabel').textContent = 'Szerokość (mm)';
                    document.getElementById('heightLabel').textContent = 'Wysokość (mm)';
                    document.getElementById('quantityLabel').textContent = 'Ilość (szt)';
                    document.getElementById('quantity').value = '1';
                }
            } else {
                // Reset labels for other products
                document.getElementById('widthLabel').textContent = 'Szerokość (mm)';
                document.getElementById('heightLabel').textContent = 'Wysokość (mm)';
                document.getElementById('quantityLabel').textContent = 'Ilość (szt)';
                document.getElementById('quantity').value = '1';
                materialSection.style.display = 'block';
                thicknessSection.style.display = 'block';
                addonsContainer.style.display = 'block';
                dimensionsContainer.style.display = 'block';
                
                // Show additional dimensions for 3D products
                const needs3D = ['pojemnik', 'gablota', 'obudowa'];
                if (needs3D.includes(productType)) {
                    additionalDimensions.style.display = 'block';
                    document.getElementById('depth').required = true;
                    
                    // Hide wall thickness for gablota, pojemnik and obudowa (use material thickness instead)
                    if (productType === 'gablota' || productType === 'pojemnik' || productType === 'obudowa') {
                        wallThicknessGroup.style.display = 'none';
                        document.getElementById('wallThickness').value = '';
                    } else {
                        wallThicknessGroup.style.display = 'block';
                    }
                } else {
                    additionalDimensions.style.display = 'none';
                    document.getElementById('depth').required = false;
                    wallThicknessGroup.style.display = 'block';
                }
            }

            // Show product-specific options
            if (productType === 'ekspozytory') {
                optionsContainer.style.display = 'block';
                optionsContainer.innerHTML = generateEkspozytoryHTML();
            } else if (productType === 'impuls_kasowy') {
                optionsContainer.style.display = 'block';
                optionsContainer.innerHTML = generateImpulsKasowyHTML();
            } else if (productOptions[productType]) {
                optionsContainer.style.display = 'block';
                optionsContainer.innerHTML = generateProductOptionsHTML(productType);
                
                // For LEDON and EKSPOZYTOR, trigger calculation after generating options with default selections
                if (productType === 'ledon' || productType === 'ekspozytor') {
                    setTimeout(() => calculatePrice(), 100); // Small delay to ensure DOM is updated
                }
            } else {
                optionsContainer.style.display = 'none';
            }

            calculatePrice();
        }

        function generateEkspozytoryHTML() {
            const ekspozytoryTypes = [
                {
                    id: 'podstawkowy',
                    name: 'Podstawkowy',
                    description: 'Płaska podstawa z pionową ścianką tylną i (opcjonalnie) bocznymi. Prosty ekspozytor na blat sklepu.',
                    icon: 'icons/podstawkowy.png',
                    isImage: true
                },
                {
                    id: 'schodkowy',
                    name: 'Schodkowy',
                    description: 'Ekspozytor z minimum dwoma poziomami półek ułożonych schodkowo. Stabilizowany bocznymi ściankami i plecami.',
                    icon: 'icons/schodkowy.png',
                    isImage: true
                },
                {
                    id: 'haczykami',
                    name: 'Z haczykami',
                    description: 'Tylna płyta plexi z otworami na haczyki. Może mieć podstawę i boczne ścianki dla stabilizacji.',
                    icon: 'icons/haczykami.png',
                    isImage: true
                },
                {
                    id: 'wiszacy',
                    name: 'Wiszący',
                    description: 'Montowany na ścianie lub regale. Składa się z tylnej płyty z półkami lub kieszeniami.',
                    icon: 'icons/wiszacy.png',
                    isImage: true
                },
                {
                    id: 'stojak',
                    name: 'Stojak',
                    description: 'Pionowa konstrukcja z plecami, podstawą i (opcjonalnie) półkami. Może być wolnostojący lub wsparty.',
                    icon: 'icons/stojak.png',
                    isImage: true
                },
                {
                    id: 'kosmetyczny',
                    name: 'Kosmetyczny',
                    description: 'Rozbudowany ekspozytor z przegrodami, półkami i płytą z otworami na produkty. Często z topperem i grafiką.',
                    icon: 'icons/kosmetyczny.png',
                    isImage: true
                },
                {
                    id: 'impuls',
                    name: 'Impuls kasowy',
                    description: 'Ekspozytor przykasowy z plexi z plecami, bokami i półkami z zagięciami ograniczającymi 60mm.',
                    icon: 'icons/impuls.png',
                    isImage: true
                }
            ];

            let html = `
                <div class="section-title">🏪 Wybierz typ ekspozytora</div>
                <div class="ekspozytory-grid">
            `;

            ekspozytoryTypes.forEach(type => {
                const isSelected = selectedEkspozytorType === type.id ? 'selected' : '';
                const iconHtml = type.isImage 
                    ? `<img src="${type.icon}" alt="${type.name}" style="width: 32px; height: 32px; object-fit: contain;">`
                    : `<i class="${type.icon}"></i>`;
                
                html += `
                    <div class="ekspozytor-button ${isSelected}" onclick="selectEkspozytorType('${type.id}')">
                        <div class="ekspozytor-icon">
                            ${iconHtml}
                        </div>
                        <div class="ekspozytor-title">${type.name}</div>
                        <div class="ekspozytor-description">${type.description}</div>
                    </div>
                `;
            });

            html += `
                </div>
                <div id="ekspozytorParameters" style="margin-top: 40px; display: none;">
                    <!-- Parametry wybranego ekspozytora będą tutaj -->
                </div>
            `;

            return html;
        }

        function generateImpulsKasowyHTML() {
            let html = `
                <div class="section-title">🏪 Impuls kasowy z plexi</div>
                <p style="color: #666; font-style: italic; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                    Ekspozytor przykasowy z plexi składający się z pleców, boków i półek z zagięciami ograniczającymi o wysokości 60mm.
                </p>
                
                <!-- Rodzaj plexi -->
                <div style="padding: 15px; background: #f0f4ff; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #667eea; margin-bottom: 15px; font-size: 16px;">🧱 Rodzaj plexi</h6>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="radio" name="impuls_plexi_type" value="bezbarwna" checked onchange="calculatePrice();">
                                <span>Plexi bezbarwna (30 zł/m²)</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="radio" name="impuls_plexi_type" value="biala" onchange="calculatePrice();">
                                <span>Plexi biała (+10%) (33 zł/m²)</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Grubość materiału -->
                <div style="padding: 15px; background: #f0f4ff; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #667eea; margin-bottom: 15px; font-size: 16px;">📏 Grubość plexi</h6>
                    <div>
                        <label style="font-size: 14px; color: #667eea; font-weight: 600;">Grubość plexi (mm):</label>
                        <select id="impuls_thickness" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" onchange="calculatePrice();">
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                            <option value="6">6 mm</option>
                            <option value="8">8 mm</option>
                            <option value="10">10 mm</option>
                            <option value="12">12 mm</option>
                            <option value="15">15 mm</option>
                            <option value="20">20 mm</option>
                        </select>
                    </div>
                </div>
                
                <!-- Wymiary -->
                <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #2e7d32; margin-bottom: 15px; font-size: 16px;">📐 Wymiary zewnętrzne</h6>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Szerokość (mm):</label>
                            <input type="number" id="impuls_width" min="100" value="300" step="1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   onchange="calculatePrice();" placeholder="300">
                        </div>
                        <div>
                            <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Wysokość (mm):</label>
                            <input type="number" id="impuls_height" min="100" value="400" step="1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   onchange="calculatePrice();" placeholder="400">
                        </div>
                        <div>
                            <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Głębokość (mm):</label>
                            <input type="number" id="impuls_depth" min="50" value="150" step="1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   onchange="calculatePrice();" placeholder="150">
                        </div>
                    </div>
                </div>
                
                <!-- Liczba półek i ilość -->
                <div style="padding: 15px; background: #fff3e0; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #f57c00; margin-bottom: 15px; font-size: 16px;">📚 Półki z ogranicznikami</h6>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 14px; color: #f57c00; font-weight: 600;">Liczba półek (min. 2):</label>
                            <input type="number" id="impuls_shelves_count" min="2" value="2" step="1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   onchange="calculatePrice();" placeholder="2">
                        </div>
                        <div>
                            <label style="font-size: 14px; color: #f57c00; font-weight: 600;">Ilość ekspozytorów (szt):</label>
                            <input type="number" id="impuls_quantity" min="1" value="1" step="1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   onchange="calculatePrice();" placeholder="1">
                        </div>
                    </div>
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        Każda półka ma zagięty ogranicznik o wysokości 60mm z przodu
                    </small>
                </div>
                
                <!-- Grafika -->
                <div style="padding: 15px; background: #fff8e1; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #f57c00; margin-bottom: 15px; font-size: 16px;">🎨 Grafika na plecach</h6>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="impuls_option_grafika_jednostronna" onchange="handleImpulsGrafika(this); calculatePrice();">
                                <span>Grafika jednostronna (75 zł/m²)</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="impuls_option_grafika_dwustronna" onchange="handleImpulsGrafika(this); calculatePrice();">
                                <span>Grafika dwustronna (150 zł/m²)</span>
                            </label>
                        </div>
                    </div>
                    <small style="color: #666; font-size: 12px; margin-top: 10px; display: block;">
                        Grafika naklejana na plecy ekspozytora. Do grafiki nie jest dodawany mnożnik kosztowy.
                    </small>
                </div>
                
                <!-- Informacje o konstrukcji -->
                <div style="padding: 15px; background: #f3e5f5; border-radius: 8px; margin-bottom: 15px;">
                    <h6 style="color: #7b1fa2; margin-bottom: 15px; font-size: 16px;">ℹ️ Informacje o konstrukcji</h6>
                    <ul style="color: #666; font-size: 14px; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li><strong>Plecy:</strong> płyta z plexi (bezbarwnej lub białej)</li>
                        <li><strong>Boki:</strong> ścianki z plexi bezbarwnej</li>
                        <li><strong>Półki:</strong> z zagięciami ograniczającymi 60mm z przodu</li>
                        <li><strong>Mnożnik kosztowy:</strong> 1,8 (tylko na materiał)</li>
                        <li><strong>Grafika:</strong> bez mnożnika, liczona osobno</li>
                    </ul>
                </div>
            `;
            
            return html;
        }

        function calculateImpulsKasowySurfaceArea(impulsWidth, impulsHeight, impulsDepth, quantity) {
            // Get shelves count from impuls-specific input
            const shelvesCount = parseInt(document.getElementById('impuls_shelves_count')?.value) || 2;
            
            // Calculate surface areas for each component
            // 1. Plecy (back panel): width × height
            const backSurface = (impulsWidth * impulsHeight) / 1000000; // Convert mm² to m²
            
            // 2. Boki (sides): depth × height × 2 sides
            const sidesSurface = (impulsDepth * impulsHeight * 2) / 1000000;
            
            // 3. Półki (shelves): width × depth × number of shelves
            const shelvesSurface = (impulsWidth * impulsDepth * shelvesCount) / 1000000;
            
            // 4. Ograniczniki (limiters): width × 60mm × number of shelves
            const limiterHeight = 60; // mm
            const limitersSurface = (impulsWidth * limiterHeight * shelvesCount) / 1000000;
            
            // Total surface area
            const totalSurface = (backSurface + sidesSurface + shelvesSurface + limitersSurface) * quantity;
            
            console.log('Impuls kasowy surface calculation:', {
                impulsWidth, impulsHeight, impulsDepth, shelvesCount, quantity,
                backSurface, sidesSurface, shelvesSurface, limitersSurface,
                totalSurface
            });
            
            return totalSurface;
        }

        function selectEkspozytorType(typeId) {
            selectedEkspozytorType = typeId;
            
            // Update button selection
            document.querySelectorAll('.ekspozytor-button').forEach(button => {
                button.classList.remove('selected');
            });
            event.target.closest('.ekspozytor-button').classList.add('selected');
            
            // Show parameters section
            const parametersSection = document.getElementById('ekspozytorParameters');
            if (parametersSection) {
                parametersSection.style.display = 'block';
                if (typeId === 'impuls') {
                    // For impuls type, redirect to the dedicated impuls_kasowy product type
                    document.getElementById('productType').value = 'impuls_kasowy';
                    updateProductOptions();
                    return;
                } else {
                    parametersSection.innerHTML = generateEkspozytorParametersHTML(typeId);
                }
                /*parametersSection.innerHTML = `
                    <div class="section-title">���️ Parametry ekspozytora: ${typeId}</div>
                    <p style="color: #666; font-style: italic; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        Szczegółowe parametry dla typu "${typeId}" będą dodane w następnym etapie rozwoju.
                    </p>
                `;*/
            }
            
            console.log('Selected ekspozytor type:', typeId);
        }

        function generateProductOptionsHTML(productType) {
            const options = productOptions[productType];
            let html = `<h4 class="section-title">Opcje dla: ${productType}</h4>`;

            Object.keys(options).forEach(category => {
                const categoryName = category === 'types' ? (productType === 'ekspozytor' ? 'Rodzaj ekspozytora' : 'Rodzaj kasetonu') : 
                                   category === 'letters' ? 'Opcje liter' : 
                                   category === 'podstawa' ? 'Opcje podstawy' :
                                   category === 'hardware' ? 'Okucia' :
                                   category === 'przegrody' ? 'Przegrody' :
                                   category === 'klapka' ? 'Klapka' :
                                   category === 'plexi_type' ? 'Rodzaj plexi' :
                                   category === 'plexi_types' ? 'Rodzaj plexi' :
                                   category === 'led_type' ? 'Typ taśmy LED' :
                                   category === 'options' ? 'Opcje dodatkowe' :
                                   category === 'additional_options' ? 'Opcje dodatkowe' :
                                   category.replace('_', ' ');
                
                html += `
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #667eea; margin-bottom: 10px;">
                            ${categoryName}
                        </h5>
                        <div class="options-grid">
                `;

                options[category].forEach((option, index) => {
                    const priceText = option.price === 0 ? 'Bez dopłaty' : `${option.price} zł/${option.unit}`;
                    const inputType = (productType === 'kaseton' && category === 'types') || 
                                     (productType === 'gablota' && category === 'podstawa') ||
                                     (productType === 'ledon' && (category === 'plexi_type' || category === 'led_type')) ||
                                     (productType === 'ekspozytor' && (category === 'types' || category === 'plexi_types')) ? 'radio' : 'checkbox';
                    const inputName = (productType === 'kaseton' && category === 'types') ? 'kaseton_type' : 
                                     (productType === 'gablota' && category === 'podstawa') ? 'podstawa_type' :
                                     (productType === 'ledon' && category === 'plexi_type') ? 'plexi_type' :
                                     (productType === 'ledon' && category === 'led_type') ? 'led_type' :
                                     (productType === 'ekspozytor' && category === 'types') ? 'ekspozytor_type' :
                                     (productType === 'ekspozytor' && category === 'plexi_types') ? 'ekspozytor_plexi' : '';
                    
                    // Domyślny wybór dla pierwszego elementu radio button w LEDON i ekspozytorach
                    const defaultChecked = ((productType === 'ledon' || productType === 'ekspozytor') && inputType === 'radio' && index === 0) ? 'checked' : '';
                    
                    // Add description for ekspozytor types
                    let descriptionHtml = '';
                    if (productType === 'ekspozytor' && category === 'types' && option.description) {
                        descriptionHtml = `<br><small style="color: #888; font-style: italic;">${option.description}</small>`;
                    }
                    
                    html += `
                        <div class="option-card">
                            <div class="checkbox-group">
                                <input type="${inputType}" id="option_${option.id}" value="${option.id}" 
                                       name="${inputName}" data-price="${option.price}" data-unit="${option.unit}" 
                                       ${defaultChecked} onchange="calculatePrice(); toggleCustomBase('${option.id}'); showTypeDescription('${option.id}')">
                                <label for="option_${option.id}">
                                    <strong>${option.name}</strong><br>
                                    <small style="color: #666;">${priceText}</small>
                                    ${descriptionHtml}
                                </label>
                            </div>
                    `;
                    
                    // Don't show quantity input for radio buttons
                    if (inputType === 'checkbox') {
                        // Determine step and validation based on option type
                        let step = '0.1'; // Default for measurements (mb, m2)
                        let placeholder = 'Ilość';
                        let inputAttributes = '';
                        
                        if (option.integer_only || option.jednostka === 'szt' || option.jednostka === 'otwory' || 
                            option.diagonal || category === 'hardware' || category === 'przegrody' ||
                            category === 'letters' || option.unit === 'szt') {
                            step = '1'; // Pełne liczby
                            placeholder = 'Sztuki';
                            inputAttributes = 'pattern="[0-9]*" oninput="this.value = Math.floor(this.value)"';
                        }
                        
                        // Special handling for custom options
                        if (option.custom_height) {
                            placeholder = 'Wysokość (mm)';
                            step = '1';
                            inputAttributes = 'pattern="[0-9]*" oninput="this.value = Math.floor(this.value)"';
                        } else if (option.custom_area) {
                            placeholder = 'Powierzchnia (m²)';
                            step = '0.01';
                        }
                        
                        html += `
                            <input type="number" id="option_qty_${option.id}" min="0" value="0" step="${step}"
                                   style="width: 100%; margin-top: 10px;" placeholder="${placeholder}" 
                                   ${inputAttributes} onchange="calculatePrice()">
                        `;
                    }
                    
                    // Add custom material selection for custom base
                    if (option.customizable && category === 'podstawa') {
                        html += `
                            <div id="custom_base_${option.id}" style="display: none; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                                <h6 style="margin-bottom: 10px; color: #667eea;">Parametry podstawy:</h6>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <select id="base_material_${option.id}" onchange="updateBaseThickness('${option.id}'); calculatePrice();">
                                        <option value="">Wybierz materiał</option>
                                    </select>
                                    <select id="base_thickness_${option.id}" onchange="calculatePrice();">
                                        <option value="">Grubość</option>
                                    </select>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Add custom configuration for partitions
                    if (option.customizable && category === 'przegrody') {
                        html += `
                            <div id="custom_partition_${option.id}" style="display: none; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                                <h6 style="margin-bottom: 10px; color: #667eea;">Konfiguracja przegród:</h6>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">Liczba przegród:</label>
                                        <input type="number" id="partition_count_${option.id}" min="1" value="1" step="1"
                                               style="width: 100%; padding: 4px;" onchange="calculatePrice();">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">Kierunek:</label>
                                        <select id="partition_direction_${option.id}" onchange="calculatePrice();" style="width: 100%; padding: 4px;">
                                            <option value="width">Wzdłuż szerokości</option>
                                            <option value="height">Wzdłuż wysokości</option>
                                        </select>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 11px;">Wymiary przegród będą obliczone automatycznie z wymiarów pojemnika</small>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                });

                // Add LED length input for LEDON after all LED type options
                if (productType === 'ledon' && category === 'led_type') {
                    html += `
                        <div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                            <label style="font-size: 14px; color: #667eea; font-weight: 600;">Długość taśmy LED (m):</label>
                            <input type="number" id="led_length" min="0.1" value="1" step="0.1"
                                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                   placeholder="Wprowadź długość w metrach" onchange="calculatePrice();">
                            <small style="color: #666; font-size: 12px;">Długość taśmy LED potrzebna do projektu</small>
                        </div>
                    `;
                }
                
                // Add comprehensive configuration for ekspozytors after plexi type selection
                if (productType === 'ekspozytor' && category === 'plexi_types') {
                    html += `
                        <div style="margin-top: 20px;" id="ekspozytor_config">
                            <!-- 🧱 Grubość materiału -->
                            <div style="padding: 15px; background: #f0f4ff; border-radius: 8px; margin-bottom: 15px;">
                                <h6 style="color: #667eea; margin-bottom: 15px; font-size: 16px;">🧱 Grubość materiału (2-5mm)</h6>
                                <div>
                                    <label style="font-size: 14px; color: #667eea; font-weight: 600;">Grubość plexi (mm):</label>
                                    <select id="ekspozytor_thickness" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" onchange="calculatePrice();">
                                        <option value="2">2 mm</option>
                                        <option value="3" selected>3 mm</option>
                                        <option value="4">4 mm</option>
                                        <option value="5">5 mm</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Dynamiczne pola wymiarów będą generowane przez JavaScript -->
                            <div id="dimensions_section"></div>
                            
                            <!-- Opcje grafiki -->
                            <div id="graphics_section" style="padding: 15px; background: #fff8e1; border-radius: 8px; margin-bottom: 15px; display: none;">
                                <h6 style="color: #f57c00; margin-bottom: 15px; font-size: 16px;">🎨 Grafika na ściankach</h6>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="graphics_type" value="none" checked onchange="calculatePrice();">
                                            <span>Bez grafiki</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="graphics_type" value="single" onchange="calculatePrice();">
                                            <span>Grafika jednostronna (75 zł/m²)</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="graphics_type" value="double" onchange="calculatePrice();">
                                            <span>Grafika dwustronna (150 zł/m²)</span>
                                        </label>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px; margin-top: 10px; display: block;">Grafika liczona automatycznie po wymiarach ścianki tylnej. Do grafiki nie dodawany mnożnik.</small>
                            </div>
                            
                            <!-- Opcjonalne elementy -->
                            <div id="optional_elements_section" style="padding: 15px; background: #f3e5f5; border-radius: 8px; margin-bottom: 15px; display: none;">
                                <h6 style="color: #7b1fa2; margin-bottom: 15px; font-size: 16px;">⚙️ Opcjonalne elementy</h6>
                                <div id="optional_elements_content"></div>
                            </div>
                            
                            <!-- 🎨 Toper (tylko dla kosmetyczny) -->
                            <div id="topper_section" style="padding: 15px; background: #fff3cd; border-radius: 8px; margin-bottom: 15px; display: none;">
                                <h6 style="color: #856404; margin-bottom: 15px; font-size: 16px;">🎨 Toper</h6>
                                <div style="margin-bottom: 15px;">
                                    <label style="font-size: 14px; color: #856404; font-weight: 600;">Toper – wysokość (mm):</label>
                                    <input type="number" id="topper_height" min="0" value="0" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="0 = bez topera">
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox" id="topper_grafika_jednostronna" onchange="handleToperGrafika(this); calculatePrice();">
                                            <span>Toper z grafiką jednostronną (+75 zł/m²)</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox" id="topper_grafika_dwustronna" onchange="handleToperGrafika(this); calculatePrice();">
                                            <span>Toper z grafiką dwustronną (+150 zł/m²)</span>
                                        </label>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">Można wybrać tylko jedną opcję grafiki topera</small>
                            </div>
                        </div>
                    `;
                }

                html += '</div></div>';
            });

            return html;
        }

        function updateThickness() {
            const materialSelect = document.getElementById('materialSelect');
            const thicknessSelect = document.getElementById('thicknessSelect');
            
            const selectedOption = materialSelect.options[materialSelect.selectedIndex];
            const thicknesses = selectedOption.getAttribute('data-thickness');
            
            thicknessSelect.innerHTML = '<option value="">Wybierz grubość</option>';
            
            if (thicknesses) {
                thicknesses.split(',').forEach(thickness => {
                    const option = document.createElement('option');
                    option.value = thickness;
                    option.textContent = thickness + ' mm';
                    thicknessSelect.appendChild(option);
                });
            }
            
            calculatePrice();
        }

        function calculatePrice() {
            const productType = document.getElementById('productType').value;
            console.log('calculatePrice called for productType:', productType);
            
            const materialSelect = document.getElementById('materialSelect');
            const thicknessSelect = document.getElementById('thicknessSelect');
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const depth = parseFloat(document.getElementById('depth').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            
            // Skip standard validation for products with custom inputs
            if (productType !== 'impuls_kasowy' && (!width || !height || !quantity)) {
                updateDisplay(0, 0, 0, 0);
                return;
            }
            
            let materialCost = 0;
            let addonsCost = 0;
            let optionsCost = 0;
            let surfaceArea = 0;
            let thickness = 0;
            let wasteAmount = 0;
            let weight = 0;
            
            if (productType === 'kaseton') {
                // Special calculation for kaseton
                surfaceArea = (width * height * quantity) / 1000000; // Convert mm² to m²
                thickness = 3; // Fixed 3mm for kaseton
                
                console.log('Kaseton calculation:', {
                    width, height, quantity, surfaceArea,
                    productOptions: productOptions[productType]
                });
                
                // Calculate kaseton cost based on selected type
                if (productOptions[productType]) {
                    Object.keys(productOptions[productType]).forEach(category => {
                        productOptions[productType][category].forEach(option => {
                            const input = document.getElementById(`option_${option.id}`);
                            
                            console.log(`Checking option ${option.id}:`, {
                                input: input,
                                checked: input ? input.checked : 'not found',
                                category: category,
                                price: option.price
                            });
                            
                            if (input && input.checked) {
                                if (category === 'types') {
                                    // Kaseton base cost - no quantity needed for radio buttons
                                    const cost = option.price * surfaceArea;
                                    materialCost += cost;
                                    console.log(`Added material cost: ${cost}`);
                                } else if (category === 'letters') {
                                    // Letters cost (same surface area as kaseton) - checkboxes
                                    const cost = option.price * surfaceArea;
                                    optionsCost += cost;
                                    console.log(`Added options cost: ${cost}`);
                                }
                            }
                        });
                    });
                }
                
                console.log('Final kaseton costs:', {
                    materialCost, optionsCost, totalPrice: materialCost + optionsCost
                });
            } else if (productType === 'ledon') {
                // Special calculation for LEDON
                // POPRAWKA: Obliczenie rzeczywistej powierzchni (1000x1000 = 1m²)
                surfaceArea = (width * height) / 1000000; // Convert mm² to m² (rzeczywista powierzchnia)
                thickness = quantity; // For LEDON, quantity represents thickness in mm
                
                let plexiCost = 0;
                let ledCost = 0;
                let additionalOptions = 0;
                let isWaterproof = false;
                let ledQuantity = 1; // Default quantity of LEDs
                
                // Calculate plexi cost
                if (productOptions[productType]) {
                    Object.keys(productOptions[productType]).forEach(category => {
                        productOptions[productType][category].forEach(option => {
                            const input = document.getElementById(`option_${option.id}`);
                            
                            if (input && input.checked) {
                                if (category === 'plexi_type') {
                                    // Plexi cost: surface × price per m² × thickness factor × LEDON multiplier
                                    // POPRAWKA: Mnożnik 5 dla LEDON (formatka 1000x1000 = 5m² cenowo)
                                    const plexiThickness = quantity; // thickness in mm
                                    const thicknessFactor = plexiThickness / 3; // Normalizacja względem 3mm (bazowa grubość)
                                    const ledonMultiplier = 5; // Mnożnik cenowy dla LEDON
                                    plexiCost = surfaceArea * option.price * thicknessFactor * ledonMultiplier;
                                } else if (category === 'led_type') {
                                    // LED cost: length × price per meter × quantity of LEDs
                                    const ledLength = parseFloat(document.getElementById('led_length')?.value) || 0;
                                    
                                    // POPRAWKA: Obliczenie ilości LEDów na podstawie wymiarów
                                    // Zakładamy, że LEDy są rozmieszczone co 100mm (10cm)
                                    const ledsPerMeter = 10; // 10 LEDów na metr
                                    const totalLeds = Math.ceil(ledLength * ledsPerMeter);
                                    
                                    ledCost = ledLength * option.price;
                                    
                                    // Apply multiplier for Neonflex COB
                                    if (option.multiplier) {
                                        ledCost *= option.multiplier;
                                    }
                                    
                                    // Store LED quantity for display
                                    ledQuantity = totalLeds;
                                } else if (category === 'options') {
                                    if (option.percentage) {
                                        // Waterproof - percentage applied later
                                        isWaterproof = true;
                                    } else {
                                        // Fixed price options
                                        additionalOptions += option.price;
                                    }
                                }
                            }
                        });
                    });
                }
                
                // Calculate subtotal
                let subtotal = plexiCost + ledCost + additionalOptions;
                
                // Apply waterproof percentage if selected
                if (isWaterproof) {
                    subtotal *= 1.2; // +20%
                }
                
                // For LEDON: no additional final multiplier - costs are already calculated with proper multipliers
                materialCost = subtotal; // Bez dodatkowego mnożnika końcowego
                
                console.log('LEDON calculation:', {
                    width, height, quantity, surfaceArea, plexiCost, ledCost, 
                    additionalOptions, isWaterproof, subtotal, finalCost: materialCost,
                    ledQuantity: ledQuantity
                });
            } else if (productType === 'ekspozytor') {
                // Special calculation for EKSPOZYTORY
                surfaceArea = calculateSurfaceArea(productType, width, height, depth, quantity);
                
                let plexiCost = 0;
                let additionalOptionsCost = 0;
                let selectedType = null;
                let selectedPlexiType = null;
                thickness = parseFloat(document.getElementById('ekspozytor_thickness')?.value) || 3;
                
                // Get selected ekspozytor type and plexi type
                if (productOptions[productType]) {
                    Object.keys(productOptions[productType]).forEach(category => {
                        productOptions[productType][category].forEach(option => {
                            const input = document.getElementById(`option_${option.id}`);
                            
                            if (input && input.checked) {
                                if (category === 'types') {
                                    selectedType = option;
                                } else if (category === 'plexi_types') {
                                    selectedPlexiType = option;
                                } else if (category === 'additional_options') {
                                    const qtyInput = document.getElementById(`option_qty_${option.id}`);
                                    const qty = parseFloat(qtyInput?.value) || 1;
                                    
                                    if (option.no_multiplier) {
                                        // Opcje bez mnożnika (grafika, LED, zamknięcie, haczyki)
                                        if (option.unit === 'm2') {
                                            additionalOptionsCost += option.price * qty * surfaceArea;
                                        } else {
                                            additionalOptionsCost += option.price * qty;
                                        }
                                    } else if (option.auto_price) {
                                        // Półki i przegrody - automatyczna wycena
                                        if (option.id === 'polki') {
                                            // Półki: dodatkowa powierzchnia
                                            const shelfArea = (width * depth * qty) / 1000000;
                                            const shelfCost = shelfArea * (selectedPlexiType?.price || 30) * thickness;
                                            additionalOptionsCost += shelfCost;
                                        } else if (option.id === 'przegrody' && selectedType?.id === 'kosmetyczny') {
                                            // Przegrody tylko dla kosmetycznych
                                            const dividerArea = (height * depth * qty) / 1000000;
                                            const dividerCost = dividerArea * (selectedPlexiType?.price || 30) * thickness;
                                            additionalOptionsCost += dividerCost;
                                        }
                                    }
                                }
                            }
                        });
                    });
                }
                
                // Calculate plexi cost
                if (selectedPlexiType) {
                    let plexiPrice = selectedPlexiType.price;
                    
                    // Handle special pricing for kolorowa plexi
                    if (selectedPlexiType.thickness && selectedPlexiType.thickness !== thickness) {
                        // For kolorowa plexi, use fixed pricing regardless of selected thickness
                        plexiCost = surfaceArea * plexiPrice;
                    } else {
                        // Standard calculation: surface × price × thickness
                        plexiCost = surfaceArea * plexiPrice * thickness;
                    }
                    
                    // Add 12% waste
                    plexiCost *= 1.12;
                    
                    // Apply type multiplier
                    if (selectedType && selectedType.multiplier) {
                        plexiCost *= selectedType.multiplier;
                    } else {
                        plexiCost *= 2.5; // Default multiplier
                    }
                }
                
                materialCost = plexiCost;
                optionsCost = additionalOptionsCost;
                
                console.log('EKSPOZYTOR calculation:', {
                    width, height, depth, quantity, surfaceArea, thickness,
                    selectedType: selectedType?.name || 'none',
                    selectedPlexiType: selectedPlexiType?.name || 'none',
                    plexiCost, additionalOptionsCost, finalCost: materialCost + optionsCost
                });
            } else if (productType === 'impuls_kasowy') {
                // Special calculation for IMPULS KASOWY
                console.log('IMPULS KASOWY: Starting calculation');
                
                // Get values from impuls-specific inputs
                const impulsWidth = parseFloat(document.getElementById('impuls_width')?.value) || 0;
                const impulsHeight = parseFloat(document.getElementById('impuls_height')?.value) || 0;
                const impulsDepth = parseFloat(document.getElementById('impuls_depth')?.value) || 0;
                const impulsQuantity = parseInt(document.getElementById('quantity')?.value) || 1;
                
                console.log('IMPULS KASOWY: Quantity field value:', document.getElementById('quantity')?.value);
                console.log('IMPULS KASOWY: Parsed quantity:', impulsQuantity);
                
                console.log('IMPULS KASOWY: Input values:', {
                    impulsWidth, impulsHeight, impulsDepth, impulsQuantity
                });
                
                if (!impulsWidth || !impulsHeight || !impulsDepth) {
                    console.log('IMPULS KASOWY: Missing required values, stopping calculation');
                    updateDisplay(0, 0, 0, 0);
                    return;
                }
                
                surfaceArea = calculateImpulsKasowySurfaceArea(impulsWidth, impulsHeight, impulsDepth, impulsQuantity);
                
                let plexiCost = 0;
                let additionalOptionsCost = 0;
                let selectedPlexiType = null;
                thickness = parseFloat(document.getElementById('impuls_thickness')?.value) || 3;
                
                // Get selected plexi type
                const plexiTypeInputs = document.querySelectorAll('input[name="impuls_plexi_type"]:checked');
                if (plexiTypeInputs.length > 0) {
                    const plexiTypeId = plexiTypeInputs[0].value;
                    selectedPlexiType = productOptions[productType].plexi_types.find(type => type.id === plexiTypeId);
                }
                
                if (selectedPlexiType) {
                    // Calculate plexi cost: surface × price × thickness (like standard plates)
                    plexiCost = surfaceArea * selectedPlexiType.price * thickness;
                    
                    console.log('IMPULS KASOWY plexi cost calculation:', {
                        surfaceArea: surfaceArea,
                        plexiPrice: selectedPlexiType.price,
                        thickness: thickness,
                        plexiCost: plexiCost
                    });
                }
                
                // Calculate additional options (graphics)
                productOptions[productType].additional_options.forEach(option => {
                    const checkbox = document.getElementById(`impuls_option_${option.id}`);
                    if (checkbox && checkbox.checked) {
                        // Graphics are calculated based on back panel surface area (impuls dimensions)
                        const backSurface = (impulsWidth * impulsHeight) / 1000000; // Convert mm² to m²
                        additionalOptionsCost += option.price * backSurface;
                        
                        console.log('IMPULS KASOWY graphics cost:', {
                            optionId: option.id,
                            backSurface: backSurface,
                            optionPrice: option.price,
                            cost: option.price * backSurface
                        });
                    }
                });
                
                // Apply multiplier to material cost only (not graphics)
                const multiplier = productOptions[productType].multiplier || 1.8;
                const materialCostWithMultiplier = plexiCost * multiplier;
                
                // Calculate total cost
                materialCost = materialCostWithMultiplier + additionalOptionsCost;
                
                // Calculate bending length for limiters (60mm height × shelf width × number of shelves)
                const shelvesCount = parseInt(document.getElementById('impuls_shelves_count')?.value) || 2;
                const bendingLength = (width * shelvesCount) / 1000; // Convert to meters
                
                // Calculate weight (surface area × thickness × density)
                const density = selectedPlexiType?.density || 1.19; // kg/m³/mm
                weight = surfaceArea * thickness * density;
                
                console.log('IMPULS KASOWY calculation:', {
                    width, height, depth, quantity, surfaceArea, thickness,
                    plexiCost, additionalOptionsCost, materialCostWithMultiplier,
                    finalCost: materialCost, shelvesCount, bendingLength, weight
                });
            } else {
                // Standard calculation for other products
                if (!materialSelect.value) {
                    updateDisplay(0, 0, 0, 0);
                    return;
                }
                
                const selectedOption = materialSelect.options[materialSelect.selectedIndex];
                const pricePerM2 = parseFloat(selectedOption.getAttribute('data-price'));
                thickness = parseFloat(thicknessSelect.value) || 0;
                
                console.log('Material selection debug:', {
                    selectedOption: selectedOption,
                    pricePerM2: pricePerM2,
                    thickness: thickness,
                    materialSelectValue: materialSelect.value,
                    thicknessSelectValue: thicknessSelect.value
                });
                
                // Calculate dimensions with waste for standard plates
                let finalWidth = width;
                let finalHeight = height;
                
                if (productType === 'plyta') {
                    const waste = quantity <= 5 ? 50 : 20; // mm
                    finalWidth = width + waste;
                    finalHeight = height + waste;
                    wasteAmount = waste;
                }
                
                // Calculate surface area based on product type
                surfaceArea = calculateSurfaceArea(productType, finalWidth, finalHeight, depth, quantity);
                
                console.log('Surface area calculation:', {
                    productType: productType,
                    finalWidth: finalWidth,
                    finalHeight: finalHeight,
                    depth: depth,
                    quantity: quantity,
                    surfaceArea: surfaceArea
                });
                
                // Calculate material cost with thickness factor and multiplier for standard plates
                let thicknessFactor = thickness > 0 ? thickness : 1; // Grubość wpływa na cenę
                materialCost = surfaceArea * pricePerM2 * thicknessFactor; // Usunięto współczynnik trudności
                
                console.log('Material cost calculation:', {
                    surfaceArea: surfaceArea,
                    pricePerM2: pricePerM2,
                    thickness: thickness,
                    thicknessFactor: thicknessFactor,
                    materialCost: materialCost
                });
                
                console.log('Product type check:', {
                    productType: productType,
                    isPlyta: productType === 'plyta',
                    materialCostBefore: materialCost
                });
                
                if (productType === 'plyta') {
                    materialCost *= 1.8; // Mnożnik dla płyt standardowych (poprawiony z 1.7 na 1.8)
                    console.log('Applied multiplier 1.8, new materialCost:', materialCost);
                } else if (productType === 'gablota' || productType === 'pojemnik') {
                    materialCost *= 1.85; // Mnożnik dla gablot i pojemników (koszty + zysk)
                } else if (productType === 'obudowa') {
                    materialCost *= 1.8; // Mnożnik dla obudów/osłon (koszty + zysk)
                }
                
                console.log('Material cost with multiplier:', {
                    productType: productType,
                    materialCostBeforeMultiplier: productType === 'plyta' ? materialCost / 1.8 : 
                                                 productType === 'gablota' || productType === 'pojemnik' ? materialCost / 1.85 : 
                                                 productType === 'obudowa' ? materialCost / 1.8 : materialCost,
                    multiplier: productType === 'plyta' ? 1.8 : 
                               productType === 'gablota' || productType === 'pojemnik' ? 1.85 : 
                               productType === 'obudowa' ? 1.8 : 1,
                    finalMaterialCost: materialCost,
                    expectedCost: surfaceArea * pricePerM2 * thicknessFactor * (productType === 'plyta' ? 1.8 : 
                                 productType === 'gablota' || productType === 'pojemnik' ? 1.85 : 
                                 productType === 'obudowa' ? 1.8 : 1)
                });
                
                // Calculate addons cost
                addons.forEach(addon => {
                    const checkbox = document.getElementById(`addon_${addon.id}`);
                    const qtyInput = document.getElementById(`addon_qty_${addon.id}`);
                    
                    if (checkbox && checkbox.checked) {
                        const qty = parseFloat(qtyInput.value) || 0;
                        let cost = 0;
                        
                        if (addon.priceByThickness && thickness > 0) {
                            // Gięcie na gorąco - cena zależna od grubości
                            const bendingPrice = bendingPrices[thickness] || 0;
                            cost = bendingPrice * qty;
                        } else if (addon.jednostka === 'godz') {
                            // Grawerowanie - czas w godzinach
                            const timeInput = document.getElementById(`addon_time_${addon.id}`);
                            const time = parseFloat(timeInput?.value) || 0;
                            cost = addon.cena * time;
                        } else if (addon.jednostka === 'otwory') {
                            // Wiercenie otworów - otwory × ilość sztuk (pełne liczby)
                            const holes = Math.round(qty); // Zaokrąglij do pełnych otworów
                            cost = addon.cena * holes * quantity;
                        } else {
                            // Standardowe dodatki
                            cost = addon.cena * qty;
                            
                            // Minimalna cena dla fazowania i polerowania
                            if (addon.minPrice && cost > 0 && cost < addon.minPrice) {
                                cost = addon.minPrice;
                            }
                        }
                        
                        addonsCost += cost;
                    }
                });

                // Calculate product options cost for non-kaseton products
                if (productOptions[productType]) {
                    Object.keys(productOptions[productType]).forEach(category => {
                        productOptions[productType][category].forEach(option => {
                            const input = document.getElementById(`option_${option.id}`);
                            const qtyInput = document.getElementById(`option_qty_${option.id}`);
                            
                            if (input && input.checked) {
                                if (productType === 'gablota' && category === 'podstawa' && option.id === 'podstawa_inna') {
                                    // Custom base calculation
                                    const baseMaterialSelect = document.getElementById(`base_material_${option.id}`);
                                    const baseThicknessSelect = document.getElementById(`base_thickness_${option.id}`);
                                    
                                    if (baseMaterialSelect && baseMaterialSelect.value && baseThicknessSelect && baseThicknessSelect.value) {
                                        const baseMaterialOption = baseMaterialSelect.options[baseMaterialSelect.selectedIndex];
                                        const basePricePerM2 = parseFloat(baseMaterialOption.getAttribute('data-price'));
                                        const baseThickness = parseFloat(baseThicknessSelect.value);
                                        
                                        // Base surface area (width × height)
                                        const baseSurfaceArea = (width * height * quantity) / 1000000;
                                        const baseCost = baseSurfaceArea * basePricePerM2 * baseThickness * 1.85; // Mnożnik dla podstawy gabloty
                                        optionsCost += baseCost;
                                    }
                                } else if (productType === 'pojemnik' && category === 'przegrody' && option.customizable) {
                                    // Partitions calculation
                                    const partitionCountInput = document.getElementById(`partition_count_${option.id}`);
                                    const partitionDirectionSelect = document.getElementById(`partition_direction_${option.id}`);
                                    
                                    if (partitionCountInput && partitionDirectionSelect) {
                                        const partitionCount = parseInt(partitionCountInput.value) || 1;
                                        const direction = partitionDirectionSelect.value;
                                        
                                        let partitionSurface = 0;
                                        if (direction === 'width') {
                                            // Przegrody wzdłuż szerokości (wysokość × głębokość)
                                            partitionSurface = (height * depth * partitionCount) / 1000000;
                                        } else {
                                            // Przegrody wzdłuż wysokości (szerokość × głębokość)
                                            partitionSurface = (width * depth * partitionCount) / 1000000;
                                        }
                                        
                                        if (option.id === 'przegrody_kratownica') {
                                            // Kratownica - dodaj również przegrody w drugim kierunku
                                            if (direction === 'width') {
                                                partitionSurface += (width * depth * partitionCount) / 1000000;
                                            } else {
                                                partitionSurface += (height * depth * partitionCount) / 1000000;
                                            }
                                        }
                                        
                                        const partitionCost = partitionSurface * pricePerM2 * thickness * 1.85; // Mnożnik dla pojemników
                                        optionsCost += partitionCost;
                                    }
                                } else if (productType === 'pojemnik' && option.diagonal) {
                                    // Diagonal flap calculation (trapezoid)
                                    const qty = parseInt(qtyInput?.value) || 0; // Pełne sztuki dla klapek
                                    if (qty > 0) {
                                        // Calculate diagonal surface: sqrt(height² + depth²) × width
                                        const diagonalLength = Math.sqrt(height * height + depth * depth);
                                        const diagonalSurface = (diagonalLength * width * qty) / 1000000;
                                        const diagonalCost = diagonalSurface * pricePerM2 * thickness * 1.85; // Mnożnik dla pojemników
                                        optionsCost += diagonalCost;
                                    }
                                } else {
                                    // Standard options calculation
                                    const qty = parseFloat(qtyInput?.value) || 1;
                                    if (option.unit === 'm2') {
                                        optionsCost += option.price * qty * surfaceArea;
                                    } else {
                                        optionsCost += option.price * qty;
                                    }
                                }
                            }
                        });
                    });
                }
            }
            
            const totalPrice = materialCost + addonsCost + optionsCost;
            
            // Pass LED quantity for LEDON products
            const ledQuantityForDisplay = (productType === 'ledon' && typeof ledQuantity !== 'undefined') ? ledQuantity : 0;
            
            updateDisplay(surfaceArea, materialCost, addonsCost, optionsCost, totalPrice, wasteAmount, thickness, ledQuantityForDisplay, weight);
        }

        function calculateSurfaceArea(productType, width, height, depth, quantity) {
            const needs3D = ['pojemnik', 'gablota', 'kaseton', 'obudowa', 'ekspozytor'];
            
            if (needs3D.includes(productType) && depth > 0) {
                // 3D calculation
                const bottom = (width * height) / 1000000;
                const sides = 2 * ((width * depth) + (height * depth)) / 1000000;
                return (bottom + sides) * quantity;
            } else {
                // 2D calculation
                return (width * height * quantity) / 1000000;
            }
        }

        function updateDisplay(surfaceArea, materialCost, addonsCost, optionsCost, totalPrice = 0, wasteAmount = 0, thickness = 0, ledQuantity = 0, weight = 0) {
            document.getElementById('surfaceArea').textContent = surfaceArea.toFixed(4);
            document.getElementById('materialCost').textContent = materialCost.toFixed(2);
            document.getElementById('addonsCost').textContent = addonsCost.toFixed(2);
            document.getElementById('optionsCost').textContent = optionsCost.toFixed(2);
            document.getElementById('totalPrice').textContent = totalPrice.toFixed(2);
            document.getElementById('totalPriceBrutto').textContent = (totalPrice * 1.23).toFixed(2);
            
            // Store product cost for total calculation
            currentCalculation.productCost = totalPrice;
            
            // Calculate logistics
            calculateLogistics();
            
            // Show waste info for standard plates
            const wasteInfo = document.getElementById('wasteInfo');
            const productType = document.getElementById('productType').value;
            if (productType === 'plyta' && wasteAmount > 0) {
                wasteInfo.style.display = 'block';
                document.getElementById('wasteAmount').textContent = wasteAmount;
            } else {
                wasteInfo.style.display = 'none';
            }
            
            // Show thickness info
            const thicknessInfo = document.getElementById('thicknessInfo');
            if (thickness > 0) {
                thicknessInfo.style.display = 'block';
                document.getElementById('thicknessValue').textContent = thickness;
            } else {
                thicknessInfo.style.display = 'none';
            }
            
            // Show LED info for LEDON products
            const ledInfo = document.getElementById('ledInfo');
            if (productType === 'ledon' && ledQuantity > 0) {
                ledInfo.style.display = 'block';
                document.getElementById('ledQuantity').textContent = ledQuantity;
            } else {
                ledInfo.style.display = 'none';
            }
            
            // Show weight info for EKSPOZYTOR products
            const weightInfo = document.getElementById('weightInfo');
            if (productType === 'ekspozytor' && weight > 0) {
                weightInfo.style.display = 'block';
                document.getElementById('weightValue').textContent = weight.toFixed(2);
            } else {
                weightInfo.style.display = 'none';
            }
            
                    }

        function setupEventListeners() {
            // Add event listeners for option cards
            
            // Trigger logistics calculation when dimensions change
            ['width', 'height', 'depth', 'quantity', 'thicknessSelect'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculateLogistics);
                    element.addEventListener('input', calculateLogistics);
                }
            });
            
            // Save salesperson name to localStorage when changed
            const salespersonInput = document.getElementById('salesperson_name');
            if (salespersonInput) {
                salespersonInput.addEventListener('change', function() {
                    localStorage.setItem('salesperson_name', this.value);
                });
            }
            document.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox' && e.target.id.startsWith('option_')) {
                    const card = e.target.closest('.option-card');
                    if (e.target.checked) {
                        card.classList.add('selected');
                    } else {
                        card.classList.remove('selected');
                    }
                }
            });
        }
        
        function showTypeDescription(typeId) {
            // Show topper section for kosmetyczny type only
            const toperSection = document.getElementById('topper_section');
            if (toperSection) {
                const productType = document.getElementById('productType').value;
                if (productType === 'ekspozytor' && typeId === 'kosmetyczny') {
                    toperSection.style.display = 'block';
                } else {
                    toperSection.style.display = 'none';
                }
            }
            
            // Generate dynamic dimensions and options for ekspozytors
            if (productType === 'ekspozytor') {
                generateEkspozytorDimensions(typeId);
                generateEkspozytorOptions(typeId);
            }
        }
        
        function generateEkspozytorDimensions(typeId) {
            const dimensionsSection = document.getElementById('dimensions_section');
            const graphicsSection = document.getElementById('graphics_section');
            const optionalSection = document.getElementById('optional_elements_section');
            
            if (!dimensionsSection) return;
            
            let dimensionsHTML = '';
            let showGraphics = false;
            let showOptional = false;
            
            switch(typeId) {
                case 'podstawkowy':
                    dimensionsHTML = `
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; margin-bottom: 15px;">
                            <h6 style="color: #2e7d32; margin-bottom: 15px; font-size: 16px;">📏 Wymiary ekspozytora podstawkowego</h6>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Szerokość podstawy (mm):</label>
                                    <input type="number" id="ekspozytor_width" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Głębokość podstawy (mm):</label>
                                    <input type="number" id="ekspozytor_depth" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Wysokość ścianki tylnej (mm):</label>
                                    <input type="number" id="ekspozytor_back_height" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Ilość sztuk:</label>
                                    <input type="number" id="ekspozytor_quantity" min="1" value="1" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="szt">
                                </div>
                            </div>
                        </div>
                    `;
                    showGraphics = true;
                    showOptional = true;
                    break;
                    
                case 'schodkowy':
                    dimensionsHTML = `
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; margin-bottom: 15px;">
                            <h6 style="color: #2e7d32; margin-bottom: 15px; font-size: 16px;">📏 Wymiary ekspozytora schodkowego</h6>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Szerokość (mm):</label>
                                    <input type="number" id="ekspozytor_width" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Głębokość (mm):</label>
                                    <input type="number" id="ekspozytor_depth" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Wysokość (mm):</label>
                                    <input type="number" id="ekspozytor_height" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Liczba poziomów (min. 2):</label>
                                    <input type="number" id="ekspozytor_levels" min="2" value="2" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="szt">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Ilość sztuk:</label>
                                    <input type="number" id="ekspozytor_quantity" min="1" value="1" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="szt">
                                </div>
                            </div>
                        </div>
                    `;
                    showGraphics = true;
                    showOptional = true;
                    break;
                    
                // Dodaj pozostałe typy ekspozytorów...
                default:
                    dimensionsHTML = `
                        <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; margin-bottom: 15px;">
                            <h6 style="color: #2e7d32; margin-bottom: 15px; font-size: 16px;">📏 Wymiary ekspozytora</h6>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Szerokość (mm):</label>
                                    <input type="number" id="ekspozytor_width" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Wysokość (mm):</label>
                                    <input type="number" id="ekspozytor_height" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Głębokość (mm):</label>
                                    <input type="number" id="ekspozytor_depth" min="1" value="" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="mm">
                                </div>
                                <div>
                                    <label style="font-size: 14px; color: #2e7d32; font-weight: 600;">Ilość sztuk:</label>
                                    <input type="number" id="ekspozytor_quantity" min="1" value="1" step="1"
                                           style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;" 
                                           onchange="calculatePrice();" placeholder="szt">
                                </div>
                            </div>
                        </div>
                    `;
                    showGraphics = true;
            }
            
            dimensionsSection.innerHTML = dimensionsHTML;
            
            if (graphicsSection) {
                graphicsSection.style.display = showGraphics ? 'block' : 'none';
            }
            
            if (optionalSection) {
                optionalSection.style.display = showOptional ? 'block' : 'none';
            }
        }
        
        function generateEkspozytorOptions(typeId) {
            const optionalSection = document.getElementById('optional_elements_content');
            if (!optionalSection) return;
            
            let optionsHTML = '';
            
            switch(typeId) {
                case 'podstawkowy':
                    optionsHTML = `
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="optional_boki" onchange="calculatePrice();">
                                <span>Boki (krótkie ścianki boczne)</span>
                            </label>
                            <small style="color: #666; font-size: 12px; margin-left: 28px;">Zwiększają stabilność i chronią produkt przed spadnięciem</small>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="optional_laczniki" onchange="calculatePrice();">
                                <span>Łączniki (kątowniki, zaciski lub klej)</span>
                            </label>
                            <small style="color: #666; font-size: 12px; margin-left: 28px;">Łączą podstawę ze ścianką tylną i bokami</small>
                        </div>
                    `;
                    break;
                    
                case 'schodkowy':
                    optionsHTML = `
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="optional_plecy" onchange="calculatePrice();">
                                <span>Plecy (pionowa płyta tylna)</span>
                            </label>
                            <small style="color: #666; font-size: 12px; margin-left: 28px;">Dodatkowo stabilizuje konstrukcję</small>
                        </div>
                    `;
                    break;
            }
            
            optionalSection.innerHTML = optionsHTML;
        }
        
        function handleToperGrafika(checkbox) {
            // Ensure only one topper graphics option can be selected
            if (checkbox.checked) {
                if (checkbox.id === 'topper_grafika_jednostronna') {
                    document.getElementById('topper_grafika_dwustronna').checked = false;
                } else if (checkbox.id === 'topper_grafika_dwustronna') {
                    document.getElementById('topper_grafika_jednostronna').checked = false;
                }
            }
        }

        function handleImpulsGrafika(checkbox) {
            // Ensure only one impuls graphics option can be selected
            if (checkbox.checked) {
                if (checkbox.id === 'impuls_option_grafika_jednostronna') {
                    document.getElementById('impuls_option_grafika_dwustronna').checked = false;
                } else if (checkbox.id === 'impuls_option_grafika_dwustronna') {
                    document.getElementById('impuls_option_grafika_jednostronna').checked = false;
                }
            }
        }

        function saveCalculation() {
            const productType = document.getElementById('productType').value;
            const totalPrice = document.getElementById('totalPrice').textContent;
            const totalPriceBrutto = document.getElementById('totalPriceBrutto').textContent;
            
            const summary = `
                Kalkulacja PlexiSystem
                
                Rodzaj produktu: ${productType}
                Cena netto: ${totalPrice} zł
                Cena brutto: ${totalPriceBrutto} zł
                
                Wygenerowano: ${new Date().toLocaleString('pl-PL')}
            `;
            
            navigator.clipboard.writeText(summary).then(() => {
                alert('Kalkulacja skopiowana do schowka!');
            }).catch(() => {
                alert('Nie udało się skopiować do schowka');
            });
        }

        function printCalculation() {
            // Generate print-friendly view
            const printWindow = window.open('', '_blank');
            const printContent = generatePrintView();
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for content to load then print
            printWindow.onload = function() {
                printWindow.print();
            };
        }
        
        function generatePrintView() {
            const productType = document.getElementById('productType').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            const depth = document.getElementById('depth')?.value;
            const quantity = document.getElementById('quantity').value;
            
            // Get client data
            const clientData = {
                firma: document.getElementById('client_company').value,
                nip: document.getElementById('client_nip').value,
                adres: document.getElementById('client_address').value,
                kod_pocztowy: document.getElementById('client_postal_code').value,
                miasto: document.getElementById('client_city').value,
                telefon: document.getElementById('client_phone').value,
                email: document.getElementById('client_email').value,
                osoba_kontaktowa: document.getElementById('client_contact_person').value
            };
            
            // Get salesperson data
            const salespersonData = {
                name: document.getElementById('salesperson_name').value,
                date: document.getElementById('offer_date').value,
                number: document.getElementById('offer_number').value
            };
            
            // Get logistics data
            const logisticsData = {
                packaging: document.querySelector('input[name="packaging_type"]:checked')?.nextElementSibling?.textContent || '',
                delivery: document.querySelector('input[name="delivery_type"]:checked')?.nextElementSibling?.textContent || '',
                weight: document.getElementById('total_weight').textContent,
                volume: document.getElementById('total_volume').textContent,
                packagingCost: document.getElementById('packaging_cost').textContent,
                deliveryCost: document.getElementById('delivery_cost').textContent,
                totalLogisticsCost: document.getElementById('total_logistics_cost').textContent
            };
            
            return `
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Oferta ${salespersonData.number}</title>
    <style>
        @page { margin: 20mm; }
        body { 
            font-family: Arial, sans-serif; 
            line-height: 1.6; 
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        .logo { 
            font-size: 24px; 
            font-weight: bold; 
            color: #667eea;
        }
        .offer-info {
            text-align: right;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        .total {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            text-align: right;
            margin-top: 20px;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        @media print {
            .section { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <div class="logo" style="display: flex; align-items: center; gap: 10px;">
                <svg width="40" height="40" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="10" width="80" height="80" fill="#667eea" rx="10"/>
                    <rect x="20" y="20" width="60" height="60" fill="white" rx="5"/>
                    <rect x="30" y="30" width="40" height="40" fill="#667eea" rx="3"/>
                    <text x="50" y="55" text-anchor="middle" fill="white" font-size="20" font-weight="bold">PS</text>
                </svg>
                <span>PlexiSystem</span>
            </div>
            <p>ul. Ks. Dr. Leona Heyke 11<br>84-206 Nowy Dwór Wejherowski<br>NIP: 588-239-62-72</p>
        </div>
        <div class="offer-info">
            <h2>OFERTA ${salespersonData.number}</h2>
            <p>Data: ${new Date(salespersonData.date).toLocaleDateString('pl-PL')}</p>
            <p>Handlowiec: ${salespersonData.name}</p>
        </div>
    </div>
    
    <div class="section">
        <h3>Dane klienta</h3>
        <p><strong>${clientData.firma}</strong></p>
        ${clientData.nip ? `<p>NIP: ${clientData.nip}</p>` : ''}
        ${clientData.adres ? `<p>${clientData.adres}</p>` : ''}
        ${clientData.kod_pocztowy && clientData.miasto ? `<p>${clientData.kod_pocztowy} ${clientData.miasto}</p>` : ''}
        ${clientData.osoba_kontaktowa ? `<p>Osoba kontaktowa: ${clientData.osoba_kontaktowa}</p>` : ''}
        ${clientData.telefon ? `<p>Tel: ${clientData.telefon}</p>` : ''}
        ${clientData.email ? `<p>Email: ${clientData.email}</p>` : ''}
    </div>
    
    <div class="section">
        <h3>Szczegóły produktu</h3>
        <table>
            <tr>
                <th>Produkt</th>
                <th>Wymiary</th>
                <th>Ilość</th>
                <th>Cena netto</th>
            </tr>
            <tr>
                <td>${getProductName()}</td>
                <td>${width} × ${height}${depth ? ' × ' + depth : ''} mm</td>
                <td>${quantity} szt.</td>
                <td>${currentCalculation.productCost.toFixed(2)} zł</td>
            </tr>
        </table>
        
        ${getSelectedAddonsHTML()}
    </div>
    
    <div class="section">
        <h3>Logistyka i dostawa</h3>
        <p><strong>Waga całkowita:</strong> ${logisticsData.weight} kg</p>
        <p><strong>Objętość całkowita:</strong> ${logisticsData.volume} m³</p>
        <p><strong>Sposób pakowania:</strong> ${logisticsData.packaging}</p>
        <p><strong>Sposób dostawy:</strong> ${logisticsData.delivery}</p>
        <p><strong>Koszt pakowania:</strong> ${logisticsData.packagingCost} zł</p>
        <p><strong>Koszt dostawy:</strong> ${logisticsData.deliveryCost} zł</p>
        <p><strong>Łączny koszt logistyki:</strong> ${logisticsData.totalLogisticsCost} zł</p>
    </div>
    
    <div class="section">
        <h3>Podsumowanie</h3>
        <table>
            <tr>
                <td>Wartość produktów netto:</td>
                <td style="text-align: right;">${currentCalculation.productCost.toFixed(2)} zł</td>
            </tr>
            <tr>
                <td>Koszt logistyki netto:</td>
                <td style="text-align: right;">${currentCalculation.logisticsCost.toFixed(2)} zł</td>
            </tr>
            <tr>
                <td><strong>Suma netto:</strong></td>
                <td style="text-align: right;"><strong>${(currentCalculation.productCost + currentCalculation.logisticsCost).toFixed(2)} zł</strong></td>
            </tr>
            <tr>
                <td>VAT 23%:</td>
                <td style="text-align: right;">${((currentCalculation.productCost + currentCalculation.logisticsCost) * 0.23).toFixed(2)} zł</td>
            </tr>
        </table>
        <div class="total">
            RAZEM BRUTTO: ${((currentCalculation.productCost + currentCalculation.logisticsCost) * 1.23).toFixed(2)} zł
        </div>
    </div>
    
    ${document.getElementById('handlowiec_comment').value ? `
    <div class="section">
        <h3>Uwagi</h3>
        <p>${document.getElementById('handlowiec_comment').value}</p>
    </div>
    ` : ''}
    
    <div style="margin-top: 50px; display: flex; justify-content: space-between;">
        <div style="text-align: center;">
            <p style="margin-bottom: 40px;">_______________________</p>
            <p>Podpis klienta</p>
        </div>
        <div style="text-align: center;">
            <p style="margin-bottom: 40px;">_______________________</p>
            <p>Podpis handlowca<br>${salespersonData.name}</p>
        </div>
    </div>
    
    <div class="footer">
        <p>PlexiSystem | ul. Ks. Dr. Leona Heyke 11, 84-206 Nowy Dwór Wejherowski | NIP: 588-239-62-72</p>
        <p>Tel: +48 884 042 107 | Email: lukasz@plexisystem.pl | www.plexisystem.pl</p>
    </div>
</body>
</html>
            `;
        }
        
        // Calculate logistics (weight, volume, packaging)
        function calculateLogistics() {
            const width = parseFloat(document.getElementById('width')?.value) || 0;
            const height = parseFloat(document.getElementById('height')?.value) || 0;
            const depth = parseFloat(document.getElementById('depth')?.value) || 0;
            const thickness = parseFloat(document.getElementById('thicknessSelect')?.value) || 
                            parseFloat(document.getElementById('impuls_thickness')?.value) || 3;
            const quantity = parseInt(document.getElementById('quantity')?.value) || 
                            parseInt(document.getElementById('impuls_quantity')?.value) || 1;
            
            if (width === 0 || height === 0) return;
            
            // Get material density
            const materialSelect = document.getElementById('materialSelect');
            const materialName = materialSelect?.options[materialSelect.selectedIndex]?.text || '';
            let density = MATERIAL_DENSITIES.default;
            
            for (const [material, dens] of Object.entries(MATERIAL_DENSITIES)) {
                if (materialName.includes(material)) {
                    density = dens;
                    break;
                }
            }
            
            // Calculate dimensions in meters
            const widthM = width / 1000;
            const heightM = height / 1000;
            const depthM = depth / 1000 || thickness / 1000;
            const thicknessM = thickness / 1000;
            
            // Calculate volume and weight
            let unitVolume, unitWeight;
            const productType = document.getElementById('productType').value;
            
            // For 3D products (gablota, pojemnik, obudowa), calculate surface area of walls
            if (['pojemnik', 'gablota', 'obudowa'].includes(productType) && depth > 0) {
                // Calculate total surface area of all walls in m²
                let totalSurfaceArea = 0;
                
                // Different products have different wall configurations
                switch(productType) {
                    case 'pojemnik':
                        // Pojemnik: all 5 walls (no top)
                        totalSurfaceArea = 2 * (widthM * heightM) + // Front and back
                                         2 * (depthM * heightM) + // Sides
                                         (widthM * depthM);       // Bottom only
                        break;
                    case 'gablota':
                        // Gablota: typically 4 walls (no front, has back)
                        totalSurfaceArea = (widthM * heightM) +     // Back only
                                         2 * (depthM * heightM) + // Sides
                                         (widthM * depthM);       // Bottom
                        break;
                    case 'obudowa':
                        // Obudowa: all 6 walls
                        totalSurfaceArea = 2 * (widthM * heightM) + // Front and back
                                         2 * (depthM * heightM) + // Sides
                                         2 * (widthM * depthM);   // Top and bottom
                        break;
                }
                
                // Volume = surface area × thickness
                unitVolume = totalSurfaceArea * thicknessM;
                
                // Weight = volume × density
                unitWeight = unitVolume * density;
                
                // Store surface area for display
                document.getElementById('surfaceArea').textContent = totalSurfaceArea.toFixed(3);
            } else {
                // For flat products - simple calculation
                const surfaceArea = widthM * heightM;
                unitVolume = surfaceArea * thicknessM;
                unitWeight = unitVolume * density;
                
                // Store surface area for display
                document.getElementById('surfaceArea').textContent = surfaceArea.toFixed(3);
            }
            const totalWeight = unitWeight * quantity;
            const totalVolume = unitVolume * quantity;
            
            // Update display
            document.getElementById('unit_weight').textContent = unitWeight.toFixed(2);
            document.getElementById('total_weight').textContent = totalWeight.toFixed(2);
            
            // Display volume in m³ with proper formatting
            if (unitVolume < 0.001) {
                // For very small volumes, show in cm³
                document.getElementById('unit_volume').textContent = (unitVolume * 1000000).toFixed(1) + ' cm³';
                document.getElementById('total_volume').textContent = (totalVolume * 1000000).toFixed(1) + ' cm³';
            } else {
                document.getElementById('unit_volume').textContent = unitVolume.toFixed(4) + ' m³';
                document.getElementById('total_volume').textContent = totalVolume.toFixed(4) + ' m³';
            }
            
            // Update weight info in calculation details
            const weightInfo = document.getElementById('weightInfo');
            const weightValue = document.getElementById('weightValue');
            if (weightInfo && weightValue) {
                weightInfo.style.display = 'block';
                weightValue.textContent = totalWeight.toFixed(2);
            }
            
            // Calculate packaging
            calculatePackaging(width, height, depth || thickness, quantity, totalWeight);
        }
        
        // Calculate packaging requirements
        function calculatePackaging(width, height, depth, quantity, totalWeight) {
            const packagingType = document.querySelector('input[name="packaging_type"]:checked')?.value || 'unit_box';
            const deliveryType = document.querySelector('input[name="delivery_type"]:checked')?.value || 'courier';
            
            let packagingCost = 0;
            let boxCount = 0;
            let palletCount = 0;
            
            // Add cardboard thickness to dimensions
            const boxWidth = width + 2 * CARDBOARD_THICKNESS;
            const boxHeight = height + 2 * CARDBOARD_THICKNESS;
            const boxDepth = depth + 2 * CARDBOARD_THICKNESS;
            
            switch (packagingType) {
                case 'unit_box':
                    boxCount = quantity;
                    packagingCost = PACKAGING_PRICES.unit_box * quantity;
                    break;
                    
                case 'collective_box':
                    // Calculate box surface area in m²
                    const boxSurfaceM2 = 2 * (
                        (boxWidth * boxHeight) / 1000000 +
                        (boxWidth * boxDepth) / 1000000 +
                        (boxHeight * boxDepth) / 1000000
                    );
                    boxCount = 1;
                    packagingCost = PACKAGING_PRICES.collective_box * boxSurfaceM2;
                    break;
                    
                case 'pallet':
                    // Calculate how many products fit on a pallet
                    // Try different orientations to maximize space usage
                    const orientations = [
                        { w: boxWidth, l: boxHeight, h: boxDepth },
                        { w: boxWidth, l: boxDepth, h: boxHeight },
                        { w: boxHeight, l: boxDepth, h: boxWidth }
                    ];
                    
                    let maxProductsPerPallet = 0;
                    
                    orientations.forEach(orient => {
                        const productsPerLayer = Math.floor(PALLET_DIMENSIONS.width / orient.w) * 
                                               Math.floor(PALLET_DIMENSIONS.length / orient.l);
                        const maxLayers = Math.floor(PALLET_DIMENSIONS.maxHeight / orient.h);
                        const productsThisOrientation = productsPerLayer * maxLayers;
                        
                        if (productsThisOrientation > maxProductsPerPallet) {
                            maxProductsPerPallet = productsThisOrientation;
                        }
                    });
                    
                    palletCount = Math.ceil(quantity / maxProductsPerPallet);
                    
                    // Price based on weight per pallet
                    const weightPerPallet = totalWeight / palletCount;
                    if (weightPerPallet <= 30) {
                        packagingCost = PACKAGING_PRICES.pallet.under30kg * palletCount;
                    } else {
                        packagingCost = PACKAGING_PRICES.pallet.over30kg * palletCount;
                    }
                    break;
            }
            
            // Calculate delivery cost
            let deliveryCost = DELIVERY_PRICES[deliveryType] || 0;
            
            // Special pricing for courier based on weight
            if (deliveryType === 'courier') {
                if (totalWeight <= 20) {
                    deliveryCost = 25;
                } else if (totalWeight <= 60) {
                    deliveryCost = 40;
                } else {
                    deliveryCost = 200; // Pallet for heavy items
                }
            }
            
            // Update display
            document.getElementById('box_count').textContent = boxCount;
            document.getElementById('pallet_count').textContent = palletCount;
            document.getElementById('packaging_cost').textContent = packagingCost.toFixed(2);
            document.getElementById('delivery_cost').textContent = deliveryCost.toFixed(2);
            document.getElementById('total_logistics_cost').textContent = (packagingCost + deliveryCost).toFixed(2);
            
            // Store logistics cost for total calculation
            currentCalculation.logisticsCost = packagingCost + deliveryCost;
            
            // Make sure we have valid numbers
            if (!isFinite(currentCalculation.logisticsCost) || isNaN(currentCalculation.logisticsCost)) {
                currentCalculation.logisticsCost = 0;
            }
            
            updateTotalPrice();
        }
        
        // Update total price including logistics
        function updateTotalPrice() {
            const productCost = currentCalculation.productCost || 0;
            const logisticsCost = currentCalculation.logisticsCost || 0;
            
            // Ensure valid numbers
            const totalNetto = isFinite(productCost + logisticsCost) ? productCost + logisticsCost : 0;
            const totalBrutto = totalNetto * 1.23;
            
            document.getElementById('totalPrice').textContent = totalNetto.toFixed(2);
            document.getElementById('totalPriceBrutto').textContent = totalBrutto.toFixed(2);
        }
        
        // Calculate unit carton (FEFCO 0201)
        function calculateUnitCarton() {
            const checkbox = document.getElementById('unit_carton_checkbox');
            const detailsDiv = document.getElementById('unit_carton_details');
            
            if (!checkbox.checked) {
                detailsDiv.style.display = 'none';
                currentCalculation.unitCartonCost = 0;
                updateTotalPrice();
                return;
            }
            
            detailsDiv.style.display = 'block';
            
            // Get product dimensions
            const width = parseFloat(document.getElementById('width')?.value) || 0;
            const height = parseFloat(document.getElementById('height')?.value) || 0;
            const depth = parseFloat(document.getElementById('depth')?.value) || parseFloat(document.getElementById('thicknessSelect')?.value) || 0;
            const quantity = parseInt(document.getElementById('quantity')?.value) || 1;
            
            // Add margins for carton (10mm for width/depth, 30mm for height)
            const cartonWidth = width + 10;
            const cartonDepth = depth + 10;
            const cartonHeight = height + 30;
            
            // Calculate surface area for FEFCO 0201 (klapowy)
            // Formula: 2 × (width + depth) × (height + 30mm for flaps)
            const surfaceAreaMm2 = 2 * (cartonWidth + cartonDepth) * (cartonHeight + 30);
            const surfaceAreaM2 = surfaceAreaMm2 / 1000000;
            
            // Calculate cost (8 zł/m²)
            const costPerCarton = surfaceAreaM2 * 8;
            const totalCartonCost = costPerCarton * quantity;
            
            // Update display
            document.getElementById('carton_surface').textContent = surfaceAreaM2.toFixed(4);
            document.getElementById('carton_cost').textContent = costPerCarton.toFixed(2);
            document.getElementById('total_carton_cost').textContent = totalCartonCost.toFixed(2);
            
            // Store in calculation
            currentCalculation.unitCartonCost = totalCartonCost;
            currentCalculation.logisticsCost = (currentCalculation.logisticsCost || 0) + totalCartonCost;
            
            // Recalculate packaging with new dimensions
            calculatePackaging(cartonWidth, cartonHeight, cartonDepth, quantity, 
                             parseFloat(document.getElementById('total_weight').textContent) || 0);
        }

        function toggleCustomBase(optionId) {
            const customBaseDiv = document.getElementById(`custom_base_${optionId}`);
            const customPartitionDiv = document.getElementById(`custom_partition_${optionId}`);
            const input = document.getElementById(`option_${optionId}`);
            
            if (customBaseDiv && input) {
                if (input.checked && optionId === 'podstawa_inna') {
                    customBaseDiv.style.display = 'block';
                    populateBaseMaterials(optionId);
                } else {
                    customBaseDiv.style.display = 'none';
                }
            }
            
            if (customPartitionDiv && input) {
                if (input.checked && (optionId === 'przegrody_proste' || optionId === 'przegrody_kratownica')) {
                    customPartitionDiv.style.display = 'block';
                } else {
                    customPartitionDiv.style.display = 'none';
                }
            }
        }

        function populateBaseMaterials(optionId) {
            const select = document.getElementById(`base_material_${optionId}`);
            if (!select || select.children.length > 1) return; // Already populated
            
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.nazwa} (${material.cena_za_m2} zł/m²)`;
                option.setAttribute('data-price', material.cena_za_m2);
                option.setAttribute('data-thickness', material.dostepne_grubosci.join(','));
                select.appendChild(option);
            });
        }

        function updateBaseThickness(optionId) {
            const materialSelect = document.getElementById(`base_material_${optionId}`);
            const thicknessSelect = document.getElementById(`base_thickness_${optionId}`);
            
            if (!materialSelect || !thicknessSelect) return;
            
            const selectedOption = materialSelect.options[materialSelect.selectedIndex];
            const thicknesses = selectedOption.getAttribute('data-thickness');
            
            thicknessSelect.innerHTML = '<option value="">Grubość</option>';
            
            if (thicknesses) {
                thicknesses.split(',').forEach(thickness => {
                    const option = document.createElement('option');
                    option.value = thickness;
                    option.textContent = thickness + ' mm';
                    thicknessSelect.appendChild(option);
                });
            }
        }
    function generateEkspozytorParametersHTML(typeId) {
            if (typeId === 'podstawkowy') {
                return generatePodstawkowyConfigHTML();
            } else if (typeId === 'schodkowy') {
                return generateSchodkowyConfigHTML();
            } else if (typeId === 'haczykami') {
                return generateHaczykiConfigHTML();
            } else if (typeId === 'wiszacy') {
                return generateWiszacyConfigHTML();
            } else if (typeId === 'stojak') {
                return generateStojakConfigHTML();
            } else if (typeId === 'kosmetyczny') {
                return generateKosmetycznyConfigHTML();
            } else {
                return `
                    <div class="section-title">⚙️ Parametry ekspozytora: ${typeId}</div>
                    <p style="color: #666; font-style: italic; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        Szczegółowe parametry dla typu "${typeId}" będą dodane w następnym etapie rozwoju.
                    </p>
                `;
            }
        }

        function generatePodstawkowyConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora podstawkowego</div>
                
                <!-- Wymiary ekspozytora -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary ekspozytora (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość:</label>
                            <input type="number" id="podstawkowy_szerokosc" min="50" max="1500" value="300" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="300" onchange="calculateEkspozytorPrice()">
                            <small style="color: #666; font-size: 12px;">50 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość:</label>
                            <input type="number" id="podstawkowy_wysokosc" min="50" max="1500" value="200" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="200" onchange="calculateEkspozytorPrice()">
                            <small style="color: #666; font-size: 12px;">50 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Głębokość:</label>
                            <input type="number" id="podstawkowy_glebokosc" min="30" max="800" value="150" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="150" onchange="calculateEkspozytorPrice()">
                            <small style="color: #666; font-size: 12px;">30 - 800 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Grubość plexi -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🧱 Grubość plexi</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Wybierz grubość materiału:</label>
                        <select id="podstawkowy_gruboscPlexi" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateEkspozytorPrice()">
                            <option value="1">1 mm</option>
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                        </select>
                    </div>
                </div>

                <!-- Opcje konstrukcyjne -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">⚙️ Opcje konstrukcyjne</h5>
                    
                    <!-- Boki -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="podstawkowy_boki" onchange="calculateEkspozytorPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj boki (2 dodatkowe płyty boczne)</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block; margin-top: 5px;">
                            Zwiększa stabilność i chroni produkt przed spadnięciem
                        </small>
                    </div>

                    <!-- Grafika -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na ściance tylnej:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="podstawkowy_grafika" value="brak" checked onchange="calculateEkspozytorPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="podstawkowy_grafika" value="jednostronna" onchange="calculateEkspozytorPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m��)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="podstawkowy_grafika" value="dwustronna" onchange="calculateEkspozytorPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Toper -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🎨 Toper na szerokość stojaka</h5>
                    
                    <!-- Wysokość topera -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Wysokość topera (mm):</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <input type="range" id="stojak_toper_wysokosc_slider" min="0" max="200" value="0" 
                                   oninput="updateStojakToperHeight(); calculateStojakPrice()" 
                                   style="flex: 1; height: 6px; background: #ddd; border-radius: 5px; outline: none;">
                            <input type="number" id="stojak_toper_wysokosc" min="0" max="200" value="0" 
                                   oninput="updateStojakToperHeightFromInput(); calculateStojakPrice()" 
                                   style="width: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center;">
                            <span style="color: #666; font-size: 14px;">mm</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">0 = bez topera, regulowana wysokość do 200mm</small>
                    </div>

                    <!-- Grafika na toperze -->
                    <div id="stojak_toper_grafika_container" style="display: none;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na toperze:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper_grafika" value="brak" checked onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki na toperze</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper_grafika" value="jednostronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper_grafika" value="dwustronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            <small style="color: #666; font-size: 12px;">
                                <strong>Toper:</strong> Dodatkowy element na górze stojaka o szerokości równej szerokości stojaka. 
                                Może zawierać dodatkową grafikę reklamową lub informacyjną.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Dodatkowe uwagi</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Komentarz (opcjonalnie):</label>
                        <textarea id="podstawkowy_komentarz" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="podstawkowy_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="podstawkowy_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        function calculateEkspozytorPrice() {
            if (selectedEkspozytorType === 'podstawkowy') {
                calculatePodstawkowyPrice();
            } else if (selectedEkspozytorType === 'schodkowy') {
                calculateSchodkowyPrice();
            } else if (selectedEkspozytorType === 'haczykami') {
                calculateHaczykiPrice();
            } else if (selectedEkspozytorType === 'wiszacy') {
                calculateWiszacyPrice();
            } else if (selectedEkspozytorType === 'stojak') {
                calculateStojakPrice();
            }
        }

        function calculatePodstawkowyPrice() {

            const szerokosc = parseFloat(document.getElementById('podstawkowy_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('podstawkowy_wysokosc')?.value) || 0;
            const glebokosc = parseFloat(document.getElementById('podstawkowy_glebokosc')?.value) || 0;
            const gruboscPlexi = parseFloat(document.getElementById('podstawkowy_gruboscPlexi')?.value) || 3;
            const boki = document.getElementById('podstawkowy_boki')?.checked || false;
            const grafikaRadios = document.querySelectorAll('input[name="podstawkowy_grafika"]');
            let grafika = 'brak';
            grafikaRadios.forEach(radio => {
                if (radio.checked) grafika = radio.value;
            });

            if (!szerokosc || !wysokosc || !glebokosc) {
                document.getElementById('podstawkowy_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const podstawaSurface = (szerokosc * glebokosc) / 1000000; // podstawa
            const tylnaSurface = (szerokosc * wysokosc) / 1000000; // ścianka tylna
            const bokiSurface = boki ? 2 * (glebokosc * wysokosc) / 1000000 : 0; // 2 boki jeśli wybrane
            const totalSurface = podstawaSurface + tylnaSurface + bokiSurface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.2)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.2;

            // Cena grafiki
            let grafikaPrice = 0;
            if (grafika === 'jednostronna') {
                grafikaPrice = tylnaSurface * 75;
            } else if (grafika === 'dwustronna') {
                grafikaPrice = tylnaSurface * 150;
            }

            const totalPrice = materialPrice + grafikaPrice;

            // Wyświetl szczegóły
            document.getElementById('podstawkowy_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia podstawy:</strong><br>
                        <span style="color: #667eea;">${podstawaSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia ścianki tylnej:</strong><br>
                        <span style="color: #667eea;">${tylnaSurface.toFixed(4)} m²</span>
                    </div>
                    ${boki ? `<div><strong>Powierzchnia boków:</strong><br><span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    ${grafikaPrice > 0 ? `<div><strong>Koszt grafiki pleców:</strong><br><span style="color: #ff6b6b;">${grafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    ${toperGrafikaPrice > 0 ? `<div><strong>Koszt grafiki topera 1:</strong><br><span style="color: #ff6b6b;">${toperGrafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    ${toper2GrafikaPrice > 0 ? `<div><strong>Koszt grafiki topera 2:</strong><br><span style="color: #ff6b6b;">${toper2GrafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.2) + grafika
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, 0, grafikaPrice + toperGrafikaPrice + toper2GrafikaPrice, totalPrice, 0, gruboscPlexi, 0, 0);
        }

        // Funkcje pomocnicze dla suwaków stojaka
        function updateStojakShelfDepth() {
            const slider = document.getElementById('stojak_polki_glebokosc_slider');
            const input = document.getElementById('stojak_polki_glebokosc');
            if (slider && input) {
                input.value = slider.value;
            }
        }

        function updateStojakShelfDepthFromInput() {
            const slider = document.getElementById('stojak_polki_glebokosc_slider');
            const input = document.getElementById('stojak_polki_glebokosc');
            if (slider && input) {
                slider.value = input.value;
            }
        }

        function updateStojakToperHeight() {
            const slider = document.getElementById('stojak_toper_wysokosc_slider');
            const input = document.getElementById('stojak_toper_wysokosc');
            const grafikaContainer = document.getElementById('stojak_toper_grafika_container');
            
            if (slider && input) {
                input.value = slider.value;
                
                // Pokaż/ukryj opcje grafiki topera
                if (grafikaContainer) {
                    grafikaContainer.style.display = slider.value > 0 ? 'block' : 'none';
                }
            }
        }

        function updateStojakToperHeightFromInput() {
            const slider = document.getElementById('stojak_toper_wysokosc_slider');
            const input = document.getElementById('stojak_toper_wysokosc');
            const grafikaContainer = document.getElementById('stojak_toper_grafika_container');
            
            if (slider && input) {
                slider.value = input.value;
                
                // Pokaż/ukryj opcje grafiki topera
                if (grafikaContainer) {
                    grafikaContainer.style.display = input.value > 0 ? 'block' : 'none';
                }
            }
        }

        // Funkcje pomocnicze dla drugiego topera
        function updateStojakToper2Height() {
            const slider = document.getElementById('stojak_toper2_wysokosc_slider');
            const input = document.getElementById('stojak_toper2_wysokosc');
            const grafikaContainer = document.getElementById('stojak_toper2_grafika_container');
            
            if (slider && input) {
                input.value = slider.value;
                
                // Pokaż/ukryj opcje grafiki drugiego topera
                if (grafikaContainer) {
                    grafikaContainer.style.display = slider.value > 0 ? 'block' : 'none';
                }
            }
        }

        function updateStojakToper2HeightFromInput() {
            const slider = document.getElementById('stojak_toper2_wysokosc_slider');
            const input = document.getElementById('stojak_toper2_wysokosc');
            const grafikaContainer = document.getElementById('stojak_toper2_grafika_container');
            
            if (slider && input) {
                slider.value = input.value;
                
                // Pokaż/ukryj opcje grafiki drugiego topera
                if (grafikaContainer) {
                    grafikaContainer.style.display = input.value > 0 ? 'block' : 'none';
                }
            }
        }

        function generateKosmetycznyConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora kosmetycznego</div>

                <!-- Wymiary zewnętrzne -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary zewnętrzne (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość:</label>
                            <input type="number" id="kosmetyczny_szerokosc" min="100" max="1500" value="300"
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="300" onchange="calculateKosmetycznyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość:</label>
                            <input type="number" id="kosmetyczny_wysokosc" min="100" max="2000" value="400"
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="400" onchange="calculateKosmetycznyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 2000 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Głębokość:</label>
                            <input type="number" id="kosmetyczny_glebokosc" min="80" max="600" value="150"
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="150" onchange="calculateKosmetycznyPrice()">
                            <small style="color: #666; font-size: 12px;">80 - 600 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Elementy konstrukcyjne -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🏗️ Elementy konstrukcyjne</h5>

                    <!-- Grubość plexi -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grubość plexi:</label>
                        <select id="kosmetyczny_gruboscPlexi"
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateKosmetycznyPrice()">
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                            <option value="6">6 mm</option>
                            <option value="8">8 mm</option>
                            <option value="10">10 mm</option>
                        </select>
                    </div>

                    <!-- Drugie dno -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="kosmetyczny_drugieDno" onchange="calculateKosmetycznyPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Drugie dno (dodatkowy poziom ekspozycji)</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block;">
                            Tworzy dodatkowy poziom w ekspozytorze
                        </small>
                    </div>
                </div>

                <!-- Przegrody i półki -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">📦 Przegrody i półki</h5>

                    <!-- Liczba półek -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba półek:</label>
                        <input type="number" id="kosmetyczny_liczbaPolek" min="0" max="5" value="2"
                               style="width: 100%; max-width: 200px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                               placeholder="2" onchange="updatePrzegrodyDisplay(); calculateKosmetycznyPrice()">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">0 - 5 półek z otworami na produkty</small>
                    </div>

                    <!-- Przegrody na półce -->
                    <div id="kosmetyczny_przegrody_container" style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba przegródek na każdej półce:</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <input type="range" id="kosmetyczny_przegrody_slider" min="1" max="20" value="6" 
                                   oninput="updatePrzegrodyValue(); calculateKosmetycznyPrice()" 
                                   style="flex: 1; height: 6px; background: #ddd; border-radius: 5px; outline: none;">
                            <input type="number" id="kosmetyczny_przegrodyNaPolce" min="1" max="20" value="6" 
                                   oninput="updatePrzegrodySlider(); calculateKosmetycznyPrice()" 
                                   style="width: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center;">
                            <span style="color: #666; font-size: 14px;">szt</span>
                        </div>
                        <div id="kosmetyczny_przegrody_info" style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <small style="color: #666; font-size: 12px;">
                                <strong>Szerokość jednej komory:</strong> <span id="kosmetyczny_komora_szerokosc">50</span> mm
                            </small>
                        </div>
                    </div>

                    <!-- Ograniczniki -->
                    <div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="kosmetyczny_ograniczniki" onchange="calculateKosmetycznyPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Ograniczniki na każdej półce</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block;">
                            Uniemożliwiają wypadnięcie produktów z ekspozytora
                        </small>
                    </div>
                </div>

                <!-- Topper -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🎨 Topper (opcjonalny)</h5>
                    
                    <!-- Włączenie topera -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 15px;">
                            <input type="checkbox" id="kosmetyczny_toper" onchange="toggleToperOptions(); calculateKosmetycznyPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj topper</span>
                        </label>
                        
                        <!-- Opcje topera -->
                        <div id="kosmetyczny_toper_options" style="display: none; margin-left: 28px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Wysokość topera (mm):</label>
                                <input type="number" id="kosmetyczny_wysokoscTopera" min="10" max="200" value="50"
                                       style="width: 100%; max-width: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                                       placeholder="50" onchange="calculateKosmetycznyPrice()">
                            </div>
                            
                            <!-- Grafika topera -->
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grafika na toperze:</label>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="radio" name="kosmetyczny_grafikaTopera" value="brak" checked onchange="calculateKosmetycznyPrice()"
                                               style="accent-color: #667eea;">
                                        <span>Brak grafiki</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="radio" name="kosmetyczny_grafikaTopera" value="jednostronna" onchange="calculateKosmetycznyPrice()"
                                               style="accent-color: #667eea;">
                                        <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="radio" name="kosmetyczny_grafikaTopera" value="dwustronna" onchange="calculateKosmetycznyPrice()"
                                               style="accent-color: #667eea;">
                                        <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grafika na plecach -->
                <div style="background: #f0e6ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin-bottom: 15px; font-size: 1.1rem;">🎨 Grafika na plecach</h5>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="kosmetyczny_grafikaNaPlecy" value="brak" checked onchange="calculateKosmetycznyPrice()"
                                   style="accent-color: #667eea;">
                            <span>Brak grafiki na plecach</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="kosmetyczny_grafikaNaPlecy" value="jednostronna" onchange="calculateKosmetycznyPrice()"
                                   style="accent-color: #667eea;">
                            <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="kosmetyczny_grafikaNaPlecy" value="dwustronna" onchange="calculateKosmetycznyPrice()"
                                   style="accent-color: #667eea;">
                            <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                        </label>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Komentarz dodatkowy</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Dodatkowe uwagi:</label>
                        <textarea id="kosmetyczny_komentarz" rows="3"
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="kosmetyczny_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="kosmetyczny_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        // Funkcje pomocnicze dla ekspozytora kosmetycznego
        function calculateKosmetycznyPrice() {
            if (selectedEkspozytorType !== 'kosmetyczny') return;

            const szerokosc = parseFloat(document.getElementById('kosmetyczny_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('kosmetyczny_wysokosc')?.value) || 0;
            const glebokosc = parseFloat(document.getElementById('kosmetyczny_glebokosc')?.value) || 0;
            const gruboscPlexi = parseFloat(document.getElementById('kosmetyczny_gruboscPlexi')?.value) || 3;
            const drugieDno = document.getElementById('kosmetyczny_drugieDno')?.checked || false;
            const liczbaPolek = parseInt(document.getElementById('kosmetyczny_liczbaPolek')?.value) || 0;
            const przegrodyNaPolce = parseInt(document.getElementById('kosmetyczny_przegrodyNaPolce')?.value) || 1;
            const ograniczniki = document.getElementById('kosmetyczny_ograniczniki')?.checked || false;
            const toper = document.getElementById('kosmetyczny_toper')?.checked || false;
            const wysokoscTopera = parseFloat(document.getElementById('kosmetyczny_wysokoscTopera')?.value) || 0;

            // Grafika na plecach
            const grafikaNaPlecyRadios = document.querySelectorAll('input[name="kosmetyczny_grafikaNaPlecy"]');
            let grafikaNaPlecy = 'brak';
            grafikaNaPlecyRadios.forEach(radio => {
                if (radio.checked) grafikaNaPlecy = radio.value;
            });

            // Grafika na toperze
            const grafikaToperaRadios = document.querySelectorAll('input[name="kosmetyczny_grafikaTopera"]');
            let grafikaTopera = 'brak';
            grafikaToperaRadios.forEach(radio => {
                if (radio.checked) grafikaTopera = radio.value;
            });

            if (!szerokosc || !wysokosc || !glebokosc) {
                document.getElementById('kosmetyczny_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const podstawaSurface = (szerokosc * glebokosc) / 1000000; // podstawa
            const drugieDnoSurface = drugieDno ? (szerokosc * glebokosc) / 1000000 : 0; // drugie dno
            const plecySurface = (szerokosc * wysokosc) / 1000000; // plecy
            const bokiSurface = 2 * (wysokosc * glebokosc) / 1000000; // 2 boki
            const plytyZOtworamiSurface = liczbaPolek > 0 ? liczbaPolek * (szerokosc * glebokosc) / 1000000 : 0; // płyty z otworami
            const toperSurface = toper && wysokoscTopera > 0 ? (szerokosc * wysokoscTopera) / 1000000 : 0; // topper
            const totalSurface = podstawaSurface + drugieDnoSurface + plecySurface + bokiSurface + plytyZOtworamiSurface + toperSurface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.7 dla kosmetycznego)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.7;

            // Cena grafiki na plecach
            let grafikaPlecyPrice = 0;
            if (grafikaNaPlecy === 'jednostronna') {
                grafikaPlecyPrice = plecySurface * 75;
            } else if (grafikaNaPlecy === 'dwustronna') {
                grafikaPlecyPrice = plecySurface * 150;
            }

            // Cena grafiki na toperze
            let grafikaToperaPrice = 0;
            if (toper && wysokoscTopera > 0 && grafikaTopera === 'jednostronna') {
                grafikaToperaPrice = toperSurface * 75;
            } else if (toper && wysokoscTopera > 0 && grafikaTopera === 'dwustronna') {
                grafikaToperaPrice = toperSurface * 150;
            }

            // Dodatkowe koszty za przegrody i ograniczniki
            let dodatkoweKoszty = 0;
            if (liczbaPolek > 0) {
                // Koszt cięcia otworów - 5 zł za każdy otwór
                const iloscOtworow = liczbaPolek * przegrodyNaPolce;
                dodatkoweKoszty += iloscOtworow * 5;
            }
            if (ograniczniki && liczbaPolek > 0) {
                // Koszt ograniczników - 10 zł za każdą półkę
                dodatkoweKoszty += liczbaPolek * 10;
            }

            const totalPrice = materialPrice + grafikaPlecyPrice + grafikaToperaPrice + dodatkoweKoszty;

            // Aktualizuj wyświetlanie szerokości komory
            updateKomoraSzerokosc();

            // Wyświetl szczegóły
            document.getElementById('kosmetyczny_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia podstawy:</strong><br>
                        <span style="color: #667eea;">${podstawaSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia pleców:</strong><br>
                        <span style="color: #667eea;">${plecySurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia boków:</strong><br>
                        <span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span>
                    </div>
                    ${drugieDno ? `<div><strong>Drugie dno:</strong><br><span style="color: #667eea;">${drugieDnoSurface.toFixed(4)} m²</span></div>` : ''}
                    ${liczbaPolek > 0 ? `<div><strong>Płyty z otworami (${liczbaPolek}x):</strong><br><span style="color: #667eea;">${plytyZOtworamiSurface.toFixed(4)} m²</span></div>` : ''}
                    ${toper && wysokoscTopera > 0 ? `<div><strong>Topper (${wysokoscTopera}mm):</strong><br><span style="color: #667eea;">${toperSurface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    ${liczbaPolek > 0 ? `<div><strong>Liczba otworów:</strong><br><span style="color: #ff9800;">${liczbaPolek * przegrodyNaPolce} szt</span></div>` : ''}
                    ${liczbaPolek > 0 ? `<div><strong>Szerokość komory:</strong><br><span style="color: #ff9800;">${Math.round(szerokosc / przegrodyNaPolce)} mm</span></div>` : ''}
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    ${grafikaPlecyPrice > 0 ? `<div><strong>Koszt grafiki pleców:</strong><br><span style="color: #ff6b6b;">${grafikaPlecyPrice.toFixed(2)} zł</span></div>` : ''}
                    ${grafikaToperaPrice > 0 ? `<div><strong>Koszt grafiki topera:</strong><br><span style="color: #ff6b6b;">${grafikaToperaPrice.toFixed(2)} zł</span></div>` : ''}
                    ${dodatkoweKoszty > 0 ? `<div><strong>Dodatkowe koszty:</strong><br><span style="color: #ff9800;">${dodatkoweKoszty.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.7) + grafika + dodatki
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, 0, grafikaPlecyPrice + grafikaToperaPrice + dodatkoweKoszty, totalPrice, 0, gruboscPlexi, 0, 0);
        }

        function updatePrzegrodyDisplay() {
            const liczbaPolek = parseInt(document.getElementById('kosmetyczny_liczbaPolek')?.value) || 0;
            const container = document.getElementById('kosmetyczny_przegrody_container');
            
            if (container) {
                container.style.display = liczbaPolek > 0 ? 'block' : 'none';
            }
            
            updateKomoraSzerokosc();
        }

        function updatePrzegrodyValue() {
            const slider = document.getElementById('kosmetyczny_przegrody_slider');
            const input = document.getElementById('kosmetyczny_przegrodyNaPolce');
            if (slider && input) {
                input.value = slider.value;
                updateKomoraSzerokosc();
            }
        }

        function updatePrzegrodySlider() {
            const slider = document.getElementById('kosmetyczny_przegrody_slider');
            const input = document.getElementById('kosmetyczny_przegrodyNaPolce');
            if (slider && input) {
                slider.value = input.value;
                updateKomoraSzerokosc();
            }
        }

        function updateKomoraSzerokosc() {
            const szerokosc = parseFloat(document.getElementById('kosmetyczny_szerokosc')?.value) || 300;
            const przegrodyNaPolce = parseInt(document.getElementById('kosmetyczny_przegrodyNaPolce')?.value) || 1;
            const komoraSzerokosc = Math.round(szerokosc / przegrodyNaPolce);
            
            const display = document.getElementById('kosmetyczny_komora_szerokosc');
            if (display) {
                display.textContent = komoraSzerokosc;
            }
        }

        function toggleToperOptions() {
            const checkbox = document.getElementById('kosmetyczny_toper');
            const options = document.getElementById('kosmetyczny_toper_options');
            
            if (checkbox && options) {
                options.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        function generateSchodkowyConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora schodkowego</div>
                
                <!-- Wymiary całkowite -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary całkowite (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość:</label>
                            <input type="number" id="schodkowy_szerokosc" min="100" max="1500" value="400" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="400" onchange="calculateSchodkowyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość całkowita:</label>
                            <input type="number" id="schodkowy_wysokosc" min="100" max="1500" value="300" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="300" onchange="calculateSchodkowyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Głębokość:</label>
                            <input type="number" id="schodkowy_glebokosc" min="100" max="800" value="200" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="200" onchange="calculateSchodkowyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 800 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Konstrukcja -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🏗️ Konstrukcja</h5>
                    
                    <!-- Liczba poziomów -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba poziomów (stopni):</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="schodkowy_poziomy" min="2" max="6" value="3" 
                                   style="flex: 1; accent-color: #667eea;" 
                                   oninput="updatePoziomyDisplay(); calculateSchodkowyPrice()">
                            <span id="poziomy_display" style="font-weight: bold; color: #667eea; min-width: 60px;">3 poziomy</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">2 - 6 poziomów</small>
                    </div>

                    <!-- Grubość plexi -->
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grubość plexi:</label>
                        <select id="schodkowy_gruboscPlexi" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateSchodkowyPrice()">
                            <option value="1">1 mm</option>
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                        </select>
                    </div>
                </div>

                <!-- Dodatki -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">✨ Dodatki</h5>
                    
                    <!-- Topper -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="schodkowy_topper" onchange="toggleTopperOptions(); calculateSchodkowyPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj topper (górna płyta dekoracyjna)</span>
                        </label>
                        <!-- Opcje topera -->
                        <div id="topper_options" style="display: none; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                            <!-- Wysokość topera -->
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Wysokość topera (mm):</label>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <input type="range" id="schodkowy_topper_wysokosc" min="100" max="500" value="200" step="50"
                                           style="flex: 1; accent-color: #667eea;" 
                                           oninput="updateTopperWysokoscDisplay(); calculateSchodkowyPrice()">
                                    <span id="topper_wysokosc_display" style="font-weight: bold; color: #667eea; min-width: 80px;">200 mm</span>
                                </div>
                                <small style="color: #666; font-size: 12px;">100 - 500 mm (krok 50mm)</small>
                            </div>
                            
                            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na topperze:</label>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="schodkowy_topper_grafika" value="brak" checked onchange="calculateSchodkowyPrice()"
                                           style="accent-color: #667eea;">
                                    <span>Brak grafiki</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="schodkowy_topper_grafika" value="jednostronna" onchange="calculateSchodkowyPrice()"
                                           style="accent-color: #667eea;">
                                    <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="schodkowy_topper_grafika" value="dwustronna" onchange="calculateSchodkowyPrice()"
                                           style="accent-color: #667eea;">
                                    <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Grafika na plecach -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na plecach:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="schodkowy_grafika" value="brak" checked onchange="calculateSchodkowyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="schodkowy_grafika" value="jednostronna" onchange="calculateSchodkowyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="schodkowy_grafika" value="dwustronna" onchange="calculateSchodkowyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Dodatkowe uwagi</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Komentarz (opcjonalnie):</label>
                        <textarea id="schodkowy_komentarz" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="schodkowy_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="schodkowy_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        function updatePoziomyDisplay() {
            const poziomy = document.getElementById('schodkowy_poziomy').value;
            document.getElementById('poziomy_display').textContent = poziomy + ' poziomy';
        }

        function updateTopperWysokoscDisplay() {
            const wysokosc = document.getElementById('schodkowy_topper_wysokosc').value;
            document.getElementById('topper_wysokosc_display').textContent = wysokosc + ' mm';
        }

        function toggleTopperOptions() {
            const topperChecked = document.getElementById('schodkowy_topper').checked;
            const topperOptions = document.getElementById('topper_options');
            if (topperOptions) {
                topperOptions.style.display = topperChecked ? 'block' : 'none';
            }
        }

        function calculateSchodkowyPrice() {
            if (selectedEkspozytorType !== 'schodkowy') return;

            const szerokosc = parseFloat(document.getElementById('schodkowy_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('schodkowy_wysokosc')?.value) || 0;
            const glebokosc = parseFloat(document.getElementById('schodkowy_glebokosc')?.value) || 0;
            const poziomy = parseInt(document.getElementById('schodkowy_poziomy')?.value) || 3;
            const gruboscPlexi = parseFloat(document.getElementById('schodkowy_gruboscPlexi')?.value) || 3;
            const topper = document.getElementById('schodkowy_topper')?.checked || false;
            const topperWysokosc = parseFloat(document.getElementById('schodkowy_topper_wysokosc')?.value) || 200;
            
            // Grafika na plecach
            const grafikaRadios = document.querySelectorAll('input[name="schodkowy_grafika"]');
            let grafika = 'brak';
            grafikaRadios.forEach(radio => {
                if (radio.checked) grafika = radio.value;
            });

            // Grafika na topperze
            const topperGrafikaRadios = document.querySelectorAll('input[name="schodkowy_topper_grafika"]');
            let topperGrafika = 'brak';
            topperGrafikaRadios.forEach(radio => {
                if (radio.checked) topperGrafika = radio.value;
            });

            if (!szerokosc || !wysokosc || !glebokosc) {
                document.getElementById('schodkowy_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const podstawaSurface = (szerokosc * glebokosc) / 1000000; // podstawa
            const poziomySurface = poziomy * (szerokosc * glebokosc) / 1000000; // wszystkie poziomy
            const bokiSurface = 2 * (wysokosc * glebokosc) / 1000000; // 2 boki
            const plecySurface = (wysokosc * szerokosc) / 1000000; // plecy
            const topperSurface = topper ? (szerokosc * topperWysokosc) / 1000000 : 0; // topper z dynamiczną wysokością
            const totalSurface = podstawaSurface + poziomySurface + bokiSurface + plecySurface + topperSurface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.5)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.5;

            // Cena grafiki na plecach
            let grafikaPrice = 0;
            if (grafika === 'jednostronna') {
                grafikaPrice = plecySurface * 75;
            } else if (grafika === 'dwustronna') {
                grafikaPrice = plecySurface * 150;
            }

            // Cena grafiki na topperze
            let topperGrafikaPrice = 0;
            if (topper && topperGrafika === 'jednostronna') {
                topperGrafikaPrice = topperSurface * 75;
            } else if (topper && topperGrafika === 'dwustronna') {
                topperGrafikaPrice = topperSurface * 150;
            }

            const totalGrafikaPrice = grafikaPrice + topperGrafikaPrice;
            const totalPrice = materialPrice + totalGrafikaPrice;

            // Wyświetl szczegóły
            document.getElementById('schodkowy_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia podstawy:</strong><br>
                        <span style="color: #667eea;">${podstawaSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia poziomów (${poziomy}x):</strong><br>
                        <span style="color: #667eea;">${poziomySurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia boków:</strong><br>
                        <span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia pleców:</strong><br>
                        <span style="color: #667eea;">${plecySurface.toFixed(4)} m²</span>
                    </div>
                    ${topper ? `<div><strong>Powierzchnia topera (${topperWysokosc}mm):</strong><br><span style="color: #667eea;">${topperSurface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    ${grafikaPrice > 0 ? `<div><strong>Koszt grafiki pleców:</strong><br><span style="color: #ff6b6b;">${grafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    ${topperGrafikaPrice > 0 ? `<div><strong>Koszt grafiki topera:</strong><br><span style="color: #ff6b6b;">${topperGrafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.5) + grafika
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, 0, totalGrafikaPrice, totalPrice, 0, gruboscPlexi, 0, 0);
        }

        function generateHaczykiConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora z haczykami</div>
                
                <!-- Wymiary płyty tylnej -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary płyty tylnej (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość:</label>
                            <input type="number" id="haczykami_szerokosc" min="100" max="1500" value="300" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="300" onchange="calculateHaczykiPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość:</label>
                            <input type="number" id="haczykami_wysokosc" min="100" max="2000" value="400" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="400" onchange="calculateHaczykiPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 2000 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Haczyki -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🪝 Haczyki</h5>
                    
                    <!-- Liczba haczyków -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba haczyków:</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="haczykami_liczba" min="1" max="100" value="10" 
                                   style="flex: 1; accent-color: #667eea;" 
                                   oninput="updateHaczykiDisplay(); calculateHaczykiPrice()">
                            <span id="haczyki_display" style="font-weight: bold; color: #667eea; min-width: 80px;">10 haczyków</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">1 - 100 haczyków (2,00 zł/szt)</small>
                    </div>

                    <!-- Grubość plexi -->
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grubość plexi:</label>
                        <select id="haczykami_gruboscPlexi" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateHaczykiPrice()">
                            <option value="1">1 mm</option>
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                        </select>
                    </div>
                </div>

                <!-- Konstrukcja -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">🏗️ Konstrukcja</h5>
                    
                    <!-- Podstawa -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="haczykami_podstawa" onchange="togglePodstawaOptions(); calculateHaczykiPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj podstawę (płaska płyta pod spodem)</span>
                        </label>
                        
                        <!-- Opcje podstawy -->
                        <div id="podstawa_options" style="display: none; margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Głębokość podstawy (mm):</label>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <input type="range" id="haczykami_podstawa_glebokosc" min="100" max="400" value="200" step="50"
                                           style="flex: 1; accent-color: #667eea;" 
                                           oninput="updatePodstawaGlebokoscDisplay(); calculateHaczykiPrice()">
                                    <span id="podstawa_glebokosc_display" style="font-weight: bold; color: #667eea; min-width: 80px;">200 mm</span>
                                </div>
                                <small style="color: #666; font-size: 12px;">100 - 400 mm (krok 50mm)</small>
                            </div>
                        </div>
                    </div>

                    <!-- Boki -->
                    <div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="haczykami_boki" onchange="calculateHaczykiPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj boki (2 ścianki boczne)</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block;">
                            Głębokość boków: taka sama jak głębokość podstawy
                        </small>
                    </div>
                </div>

                <!-- Dodatki -->
                <div style="background: #f0e6ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin-bottom: 15px; font-size: 1.1rem;">✨ Dodatki</h5>
                    
                    <!-- Grafika na płycie tylnej -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na płycie tylnej:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="haczykami_grafika" value="brak" checked onchange="calculateHaczykiPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="haczykami_grafika" value="jednostronna" onchange="calculateHaczykiPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="haczykami_grafika" value="dwustronna" onchange="calculateHaczykiPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Dodatkowe uwagi</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Komentarz (opcjonalnie):</label>
                        <textarea id="haczykami_komentarz" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="haczykami_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="haczykami_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        function updateHaczykiDisplay() {
            const haczyki = document.getElementById('haczykami_liczba').value;
            document.getElementById('haczyki_display').textContent = haczyki + ' haczyków';
        }

        function updatePodstawaGlebokoscDisplay() {
            const glebokosc = document.getElementById('haczykami_podstawa_glebokosc').value;
            document.getElementById('podstawa_glebokosc_display').textContent = glebokosc + ' mm';
        }

        function togglePodstawaOptions() {
            const podstawaChecked = document.getElementById('haczykami_podstawa').checked;
            const podstawaOptions = document.getElementById('podstawa_options');
            if (podstawaOptions) {
                podstawaOptions.style.display = podstawaChecked ? 'block' : 'none';
            }
        }

        function calculateHaczykiPrice() {
            if (selectedEkspozytorType !== 'haczykami') return;

            const szerokosc = parseFloat(document.getElementById('haczykami_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('haczykami_wysokosc')?.value) || 0;
            const liczbaHaczykow = parseInt(document.getElementById('haczykami_liczba')?.value) || 10;
            const gruboscPlexi = parseFloat(document.getElementById('haczykami_gruboscPlexi')?.value) || 3;
            const boki = document.getElementById('haczykami_boki')?.checked || false;
            const podstawa = document.getElementById('haczykami_podstawa')?.checked || false;
            const podstawaGlebokosc = parseFloat(document.getElementById('haczykami_podstawa_glebokosc')?.value) || 200;
            
            // Grafika na płycie tylnej
            const grafikaRadios = document.querySelectorAll('input[name="haczykami_grafika"]');
            let grafika = 'brak';
            grafikaRadios.forEach(radio => {
                if (radio.checked) grafika = radio.value;
            });

            if (!szerokosc || !wysokosc) {
                document.getElementById('haczykami_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const plytaTylnaSurface = (szerokosc * wysokosc) / 1000000; // płyta tylna
            const bokiSurface = boki ? 2 * (wysokosc * podstawaGlebokosc) / 1000000 : 0; // 2 boki o głębokości takiej jak podstawa
            const podstawaSurface = podstawa ? (szerokosc * podstawaGlebokosc) / 1000000 : 0; // podstawa z regulowaną głębokością
            const totalSurface = plytaTylnaSurface + bokiSurface + podstawaSurface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.4)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.4;

            // Cena haczyków (2,00 zł/szt)
            const haczykiPrice = liczbaHaczykow * 2.0;

            // Cena grafiki na płycie tylnej
            let grafikaPrice = 0;
            if (grafika === 'jednostronna') {
                grafikaPrice = plytaTylnaSurface * 75;
            } else if (grafika === 'dwustronna') {
                grafikaPrice = plytaTylnaSurface * 150;
            }

            const totalPrice = materialPrice + haczykiPrice + grafikaPrice;

            // Wyświetl szczegóły
            document.getElementById('haczykami_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia płyty tylnej:</strong><br>
                        <span style="color: #667eea;">${plytaTylnaSurface.toFixed(4)} m²</span>
                    </div>
                    ${boki ? `<div><strong>Powierzchnia boków:</strong><br><span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span></div>` : ''}
                    ${podstawa ? `<div><strong>Powierzchnia podstawy (${podstawaGlebokosc}mm):</strong><br><span style="color: #667eea;">${podstawaSurface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Liczba haczyków:</strong><br>
                        <span style="color: #ff9800;">${liczbaHaczykow} szt</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    <div>
                        <strong>Koszt haczyków:</strong><br>
                        <span style="color: #ff9800;">${haczykiPrice.toFixed(2)} zł</span>
                    </div>
                    ${grafikaPrice > 0 ? `<div><strong>Koszt grafiki:</strong><br><span style="color: #ff6b6b;">${grafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.4) + haczyki (${liczbaHaczykow} × 2,00 zł) + grafika
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, haczykiPrice, grafikaPrice, totalPrice, 0, gruboscPlexi, 0, 0);
        }

        function generateWiszacyConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora wiszącego</div>
                
                <!-- Wymiary płyty tylnej -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary płyty tylnej (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość:</label>
                            <input type="number" id="wiszacy_szerokosc" min="100" max="1500" value="400" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="400" onchange="calculateWiszacyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość:</label>
                            <input type="number" id="wiszacy_wysokosc" min="100" max="2000" value="600" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="600" onchange="calculateWiszacyPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 2000 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Konstrukcja -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🏗️ Konstrukcja</h5>
                    
                    <!-- Liczba półek -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba półek lub kieszeni:</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="wiszacy_polki" min="1" max="10" value="3" 
                                   style="flex: 1; accent-color: #667eea;" 
                                   oninput="updatePolkiDisplay(); calculateWiszacyPrice()">
                            <span id="polki_display" style="font-weight: bold; color: #667eea; min-width: 80px;">3 półki</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">1 - 10 półek</small>
                    </div>

                    <!-- Głębokość półek -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Głębokość półek/kieszeni (mm):</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="wiszacy_glebokosc_polek" min="50" max="200" value="80" step="10"
                                   style="flex: 1; accent-color: #667eea;" 
                                   oninput="updateGlebokoscPolekDisplay(); calculateWiszacyPrice()">
                            <span id="glebokosc_polek_display" style="font-weight: bold; color: #667eea; min-width: 80px;">80 mm</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">50 - 200 mm (krok 10mm)</small>
                    </div>

                    <!-- Grubość plexi -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grubość plexi:</label>
                        <select id="wiszacy_gruboscPlexi" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateWiszacyPrice()">
                            <option value="1">1 mm</option>
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                        </select>
                    </div>

                    <!-- Boki -->
                    <div>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="wiszacy_boki" onchange="calculateWiszacyPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj boki (2 ścianki boczne)</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block;">
                            Wysokość boków = wysokość płyty, głębokość = głębokość półek
                        </small>
                    </div>
                </div>

                <!-- Zawiesie -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">🔗 Zawiesie</h5>
                    
                    <!-- Typ zawiesia -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Typ zawiesia:</label>
                        <select id="wiszacy_typZawiesia" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="toggleZawiesieOptions(); calculateWiszacyPrice()">
                            <option value="bez_zawiesia" selected>Bez zawiesia</option>
                            <option value="haczyki_metalowe">Haczyki metalowe (2 zł/szt)</option>
                            <option value="magnesy">Magnesy (4 zł/szt)</option>
                            <option value="uchwyt_metalowy">Uchwyt metalowy (5 zł/szt)</option>
                        </select>
                    </div>

                    <!-- Opcje haczyków metalowych -->
                    <div id="haczyki_options" style="display: none; padding: 15px; background: #f0f4ff; border-radius: 8px; margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Ilość haczyków metalowych:</label>
                        <input type="number" id="wiszacy_iloscHaczykow" min="1" max="10" value="2" 
                               style="width: 100%; max-width: 200px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                               placeholder="2" onchange="calculateWiszacyPrice()">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">1 - 10 haczyków (2 zł/szt)</small>
                    </div>

                    <!-- Opcje magnesów -->
                    <div id="magnesy_options" style="display: none; padding: 15px; background: #f0f4ff; border-radius: 8px; margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Ilość magnesów:</label>
                        <input type="number" id="wiszacy_iloscMagnesow" min="1" max="10" value="4" 
                               style="width: 100%; max-width: 200px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                               placeholder="4" onchange="calculateWiszacyPrice()">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">1 - 10 magnesów (4 zł/szt)</small>
                    </div>

                    <!-- Opcje uchwytu metalowego -->
                    <div id="uchwyt_options" style="display: none; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Ilość uchwytów metalowych:</label>
                        <input type="number" id="wiszacy_iloscUchwytow" min="1" max="5" value="1" 
                               style="width: 100%; max-width: 200px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                               placeholder="1" onchange="calculateWiszacyPrice()">
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">1 - 5 uchwytów (5 zł/szt)</small>
                    </div>
                </div>

                <!-- Grafika -->
                <div style="background: #f0e6ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin-bottom: 15px; font-size: 1.1rem;">🎨 Grafika</h5>
                    
                    <!-- Grafika na płycie tylnej -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na płycie tylnej:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="wiszacy_grafika" value="brak" checked onchange="calculateWiszacyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="wiszacy_grafika" value="jednostronna" onchange="calculateWiszacyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="wiszacy_grafika" value="dwustronna" onchange="calculateWiszacyPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Dodatkowe uwagi</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Komentarz (opcjonalnie):</label>
                        <textarea id="wiszacy_komentarz" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="wiszacy_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="wiszacy_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        function updatePolkiDisplay() {
            const polki = document.getElementById('wiszacy_polki').value;
            document.getElementById('polki_display').textContent = polki + ' półki';
        }

        function updateGlebokoscPolekDisplay() {
            const glebokosc = document.getElementById('wiszacy_glebokosc_polek').value;
            document.getElementById('glebokosc_polek_display').textContent = glebokosc + ' mm';
        }

        function toggleZawiesieOptions() {
            const typZawiesia = document.getElementById('wiszacy_typZawiesia').value;
            const haczykiOptions = document.getElementById('haczyki_options');
            const magnesyOptions = document.getElementById('magnesy_options');
            const uchwytyOptions = document.getElementById('uchwyt_options');
            
            // Ukryj wszystkie opcje
            if (haczykiOptions) haczykiOptions.style.display = 'none';
            if (magnesyOptions) magnesyOptions.style.display = 'none';
            if (uchwytyOptions) uchwytyOptions.style.display = 'none';
            
            // Pokaż odpowiednią opcję
            if (typZawiesia === 'haczyki_metalowe' && haczykiOptions) {
                haczykiOptions.style.display = 'block';
            } else if (typZawiesia === 'magnesy' && magnesyOptions) {
                magnesyOptions.style.display = 'block';
            } else if (typZawiesia === 'uchwyt_metalowy' && uchwytyOptions) {
                uchwytyOptions.style.display = 'block';
            }
        }

        function calculateWiszacyPrice() {
            if (selectedEkspozytorType !== 'wiszacy') return;

            const szerokosc = parseFloat(document.getElementById('wiszacy_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('wiszacy_wysokosc')?.value) || 0;
            const liczbaPolek = parseInt(document.getElementById('wiszacy_polki')?.value) || 3;
            const glebokoscPolek = parseFloat(document.getElementById('wiszacy_glebokosc_polek')?.value) || 80;
            const gruboscPlexi = parseFloat(document.getElementById('wiszacy_gruboscPlexi')?.value) || 3;
            const boki = document.getElementById('wiszacy_boki')?.checked || false;
            const typZawiesia = document.getElementById('wiszacy_typZawiesia')?.value || 'bez_zawiesia';
            const iloscHaczykow = parseInt(document.getElementById('wiszacy_iloscHaczykow')?.value) || 2;
            const iloscMagnesow = parseInt(document.getElementById('wiszacy_iloscMagnesow')?.value) || 4;
            const iloscUchwytow = parseInt(document.getElementById('wiszacy_iloscUchwytow')?.value) || 1;
            
            // Grafika na płycie tylnej
            const grafikaRadios = document.querySelectorAll('input[name="wiszacy_grafika"]');
            let grafika = 'brak';
            grafikaRadios.forEach(radio => {
                if (radio.checked) grafika = radio.value;
            });

            if (!szerokosc || !wysokosc) {
                document.getElementById('wiszacy_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const plytaTylnaSurface = (szerokosc * wysokosc) / 1000000; // płyta tylna
            const polkiSurface = liczbaPolek * (szerokosc * glebokoscPolek) / 1000000; // półki z regulowaną głębokością
            const bokiSurface = boki ? 2 * (wysokosc * glebokoscPolek) / 1000000 : 0; // 2 boki o głębokości półek
            const totalSurface = plytaTylnaSurface + polkiSurface + bokiSurface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.2)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.2;

            // Cena zawiesia (w zależności od typu)
            let zawiesiePrice = 0;
            if (typZawiesia === 'haczyki_metalowe') {
                zawiesiePrice = iloscHaczykow * 2;
            } else if (typZawiesia === 'magnesy') {
                zawiesiePrice = iloscMagnesow * 4;
            } else if (typZawiesia === 'uchwyt_metalowy') {
                zawiesiePrice = iloscUchwytow * 5;
            }

            // Cena grafiki na płycie tylnej
            let grafikaPrice = 0;
            if (grafika === 'jednostronna') {
                grafikaPrice = plytaTylnaSurface * 75;
            } else if (grafika === 'dwustronna') {
                grafikaPrice = plytaTylnaSurface * 150;
            }

            const totalPrice = materialPrice + zawiesiePrice + grafikaPrice;

            // Wyświetl szczegóły
            document.getElementById('wiszacy_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia płyty tylnej:</strong><br>
                        <span style="color: #667eea;">${plytaTylnaSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia półek (${liczbaPolek}x, ${glebokoscPolek}mm):</strong><br>
                        <span style="color: #667eea;">${polkiSurface.toFixed(4)} m²</span>
                    </div>
                    ${boki ? `<div><strong>Powierzchnia boków:</strong><br><span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Typ zawiesia:</strong><br>
                        <span style="color: #ff9800;">${
                            typZawiesia === 'bez_zawiesia' ? 'Bez zawiesia' :
                            typZawiesia === 'haczyki_metalowe' ? `Haczyki metalowe (${iloscHaczykow} szt)` :
                            typZawiesia === 'magnesy' ? `Magnesy (${iloscMagnesow} szt)` :
                            typZawiesia === 'uchwyt_metalowy' ? `Uchwyt metalowy (${iloscUchwytow} szt)` : 'Nieznany'
                        }</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    ${zawiesiePrice > 0 ? `<div><strong>Koszt zawiesia:</strong><br><span style="color: #ff9800;">${zawiesiePrice.toFixed(2)} zł</span></div>` : ''}
                    ${grafikaPrice > 0 ? `<div><strong>Koszt grafiki:</strong><br><span style="color: #ff6b6b;">${grafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.2) ${zawiesiePrice > 0 ? `+ zawiesia (${zawiesiePrice.toFixed(2)} zł)` : ''} + grafika
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, zawiesiePrice, grafikaPrice, totalPrice, 0, gruboscPlexi, 0, 0);
        }

        function generateStojakConfigHTML() {
            return `
                <div class="section-title">⚙️ Konfiguracja ekspozytora stojak</div>
                
                <!-- Wymiary -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📏 Wymiary (mm)</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Szerokość (plecy i podstawa):</label>
                            <input type="number" id="stojak_szerokosc" min="100" max="1500" value="400" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="400" onchange="calculateStojakPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 1500 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Wysokość (plecy):</label>
                            <input type="number" id="stojak_wysokosc" min="100" max="2000" value="600" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="600" onchange="calculateStojakPrice()">
                            <small style="color: #666; font-size: 12px;">100 - 2000 mm</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Głębokość (podstawa i boki):</label>
                            <input type="number" id="stojak_glebokosc" min="80" max="600" value="200" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                   placeholder="200" onchange="calculateStojakPrice()">
                            <small style="color: #666; font-size: 12px;">80 - 600 mm</small>
                        </div>
                    </div>
                </div>

                <!-- Elementy konstrukcyjne -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin-bottom: 15px; font-size: 1.1rem;">🏗️ Elementy konstrukcyjne</h5>
                    
                    <!-- Grubość plexi -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Grubość plexi:</label>
                        <select id="stojak_gruboscPlexi" 
                                style="width: 100%; max-width: 300px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                                onchange="calculateStojakPrice()">
                            <option value="2">2 mm</option>
                            <option value="3" selected>3 mm</option>
                            <option value="4">4 mm</option>
                            <option value="5">5 mm</option>
                            <option value="6">6 mm</option>
                            <option value="8">8 mm</option>
                            <option value="10">10 mm</option>
                        </select>
                    </div>

                    <!-- Boki -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px;">
                            <input type="checkbox" id="stojak_boki" onchange="calculateStojakPrice()"
                                   style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="font-weight: 600; color: #333;">Dodaj boki (2 ścianki boczne)</span>
                        </label>
                        <small style="color: #666; font-size: 12px; margin-left: 28px; display: block;">
                            Wymiary boków: wysokość × głębokość
                        </small>
                    </div>

                    <!-- Liczba półek -->
                    <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Liczba półek (opcjonalnie):</label>
                    <input type="number" id="stojak_liczbaPolek" min="0" max="6" value="0"
                    style="width: 100%; max-width: 200px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                    placeholder="0" onchange="calculateStojakPrice()">
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">0 - 6 półek</small>
                    </div>
                    
                    <!-- Regulacja głębokości półek -->
                    <div id="stojak_polki_glebokosc_container" style="display: none; margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; border: 1px solid #b3d9ff;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">📏 Głębokość półek (mm):</label>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                    <input type="range" id="stojak_polki_glebokosc_slider" min="50" max="300" value="100" 
                    oninput="updateStojakShelfDepth(); calculateStojakPrice()" 
                    style="flex: 1; height: 6px; background: #ddd; border-radius: 5px; outline: none;">
                    <input type="number" id="stojak_polki_glebokosc" min="50" max="300" value="100" 
                    oninput="updateStojakShelfDepthFromInput(); calculateStojakPrice()" 
                    style="width: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center;">
                    <span style="color: #666; font-size: 14px;">mm</span>
                    </div>
                    <small style="color: #666; font-size: 12px;">Regulowana głębokość półek od 50mm do 300mm</small>
                    </div>
                </div>

                <!-- Grafika -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #2d5a2d; margin-bottom: 15px; font-size: 1.1rem;">🎨 Grafika</h5>
                    
                    <!-- Grafika na plecach -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na plecach:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_grafika" value="brak" checked onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_grafika" value="jednostronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_grafika" value="dwustronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dodatkowy Toper 2 -->
                <div style="background: #f0e6ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin-bottom: 15px; font-size: 1.1rem;">🎨 Dodatkowy Toper 2</h5>
                    
                    <!-- Wysokość dodatkowego topera -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Wysokość dodatkowego topera (mm):</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <input type="range" id="stojak_toper2_wysokosc_slider" min="0" max="200" value="0" 
                                   oninput="updateStojakToper2Height(); calculateStojakPrice()" 
                                   style="flex: 1; height: 6px; background: #ddd; border-radius: 5px; outline: none;">
                            <input type="number" id="stojak_toper2_wysokosc" min="0" max="200" value="0" 
                                   oninput="updateStojakToper2HeightFromInput(); calculateStojakPrice()" 
                                   style="width: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center;">
                            <span style="color: #666; font-size: 14px;">mm</span>
                        </div>
                        <small style="color: #666; font-size: 12px;">0 = bez dodatkowego topera, regulowana wysokość do 200mm</small>
                    </div>

                    <!-- Grafika na dodatkowym toperze -->
                    <div id="stojak_toper2_grafika_container" style="display: none;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">Grafika na dodatkowym toperze:</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper2_grafika" value="brak" checked onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Brak grafiki na dodatkowym toperze</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper2_grafika" value="jednostronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika jednostronna <strong>(+75 zł/m²)</strong></span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="stojak_toper2_grafika" value="dwustronna" onchange="calculateStojakPrice()"
                                       style="accent-color: #667eea;">
                                <span>Grafika dwustronna <strong>(+150 zł/m²)</strong></span>
                            </label>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            <small style="color: #666; font-size: 12px;">
                                <strong>Dodatkowy Toper:</strong> Drugi element reklamowy na górze stojaka, umieszczony nad pierwszym toperem. 
                                Pozwala na dodatkowe miejsce na grafikę lub informacje promocyjne.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Komentarz -->
                <div style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">💬 Komentarz dodatkowy</h5>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Dodatkowe uwagi:</label>
                        <textarea id="stojak_komentarz" rows="3" 
                                  style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; resize: vertical;"
                                  placeholder="Opisz niestandardowe potrzeby, specjalne wymagania lub dodatkowe informacje..."></textarea>
                        <small style="color: #666; font-size: 12px;">Pole opcjonalne - dodatkowe informacje dla producenta</small>
                    </div>
                </div>

                <!-- Podgląd kalkulacji -->
                <div id="stojak_preview" style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e1e5e9;">
                    <h5 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem;">📊 Podgląd kalkulacji</h5>
                    <div id="stojak_calculation_details">
                        <!-- Szczegóły kalkulacji będą tutaj -->
                    </div>
                </div>
            `;
        }

        function calculateStojakPrice() {
            if (selectedEkspozytorType !== 'stojak') return;

            const szerokosc = parseFloat(document.getElementById('stojak_szerokosc')?.value) || 0;
            const wysokosc = parseFloat(document.getElementById('stojak_wysokosc')?.value) || 0;
            const glebokosc = parseFloat(document.getElementById('stojak_glebokosc')?.value) || 0;
            const gruboscPlexi = parseFloat(document.getElementById('stojak_gruboscPlexi')?.value) || 3;
            const boki = document.getElementById('stojak_boki')?.checked || false;
            const liczbaPolek = parseInt(document.getElementById('stojak_liczbaPolek')?.value) || 0;
            const polkiGlebokosc = parseFloat(document.getElementById('stojak_polki_glebokosc')?.value) || 100;
            const toperWysokosc = parseFloat(document.getElementById('stojak_toper_wysokosc')?.value) || 0;
            const toper2Wysokosc = parseFloat(document.getElementById('stojak_toper2_wysokosc')?.value) || 0;

            // Pokaż/ukryj sekcję regulacji głębokości półek
            const polkiGlebokoscContainer = document.getElementById('stojak_polki_glebokosc_container');
            if (polkiGlebokoscContainer) {
                polkiGlebokoscContainer.style.display = liczbaPolek > 0 ? 'block' : 'none';
            }
            
            // Grafika na plecach
            const grafikaRadios = document.querySelectorAll('input[name="stojak_grafika"]');
            let grafika = 'brak';
            grafikaRadios.forEach(radio => {
            if (radio.checked) grafika = radio.value;
            });
            
            // Grafika na toperze
            const toperGrafikaRadios = document.querySelectorAll('input[name="stojak_toper_grafika"]');
            let toperGrafika = 'brak';
            toperGrafikaRadios.forEach(radio => {
            if (radio.checked) toperGrafika = radio.value;
            });

            // Grafika na drugim toperze
            const toper2GrafikaRadios = document.querySelectorAll('input[name="stojak_toper2_grafika"]');
            let toper2Grafika = 'brak';
            toper2GrafikaRadios.forEach(radio => {
            if (radio.checked) toper2Grafika = radio.value;
            });

            if (!szerokosc || !wysokosc || !glebokosc) {
                document.getElementById('stojak_calculation_details').innerHTML = 
                    '<p style="color: #666; font-style: italic;">Wprowadź wszystkie wymiary aby zobaczyć kalkulację</p>';
                return;
            }

            // Kalkulacja powierzchni (w m²)
            const podstawaSurface = (szerokosc * glebokosc) / 1000000; // podstawa
            const plecySurface = (szerokosc * wysokosc) / 1000000; // plecy
            const bokiSurface = boki ? 2 * (wysokosc * glebokosc) / 1000000 : 0; // 2 boki
            const polkiSurface = liczbaPolek > 0 ? liczbaPolek * (szerokosc * polkiGlebokosc) / 1000000 : 0; // półki z regulowaną głębokością
            const toperSurface = toperWysokosc > 0 ? (szerokosc * toperWysokosc) / 1000000 : 0; // toper
            const toper2Surface = toper2Wysokosc > 0 ? (szerokosc * toper2Wysokosc) / 1000000 : 0; // drugi toper
            const totalSurface = podstawaSurface + plecySurface + bokiSurface + polkiSurface + toperSurface + toper2Surface;

            // Cena materiału (30 zł/m² * grubość * mnożnik 2.5)
            const materialPrice = totalSurface * 30 * gruboscPlexi * 2.5;

            // Cena grafiki na plecach
            let grafikaPrice = 0;
            if (grafika === 'jednostronna') {
                grafikaPrice = plecySurface * 75;
            } else if (grafika === 'dwustronna') {
                grafikaPrice = plecySurface * 150;
            }

            // Cena grafiki na toperze
            let toperGrafikaPrice = 0;
            if (toperWysokosc > 0 && toperGrafika === 'jednostronna') {
                toperGrafikaPrice = toperSurface * 75;
            } else if (toperWysokosc > 0 && toperGrafika === 'dwustronna') {
                toperGrafikaPrice = toperSurface * 150;
            }

            // Cena grafiki na drugim toperze
            let toper2GrafikaPrice = 0;
            if (toper2Wysokosc > 0 && toper2Grafika === 'jednostronna') {
                toper2GrafikaPrice = toper2Surface * 75;
            } else if (toper2Wysokosc > 0 && toper2Grafika === 'dwustronna') {
                toper2GrafikaPrice = toper2Surface * 150;
            }

            const totalPrice = materialPrice + grafikaPrice + toperGrafikaPrice + toper2GrafikaPrice;

            // Wyświetl szczegóły
            document.getElementById('stojak_calculation_details').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <strong>Powierzchnia podstawy:</strong><br>
                        <span style="color: #667eea;">${podstawaSurface.toFixed(4)} m²</span>
                    </div>
                    <div>
                        <strong>Powierzchnia pleców:</strong><br>
                        <span style="color: #667eea;">${plecySurface.toFixed(4)} m²</span>
                    </div>
                    ${boki ? `<div><strong>Powierzchnia boków:</strong><br><span style="color: #667eea;">${bokiSurface.toFixed(4)} m²</span></div>` : ''}
                    ${liczbaPolek > 0 ? `<div><strong>Powierzchnia półek (${liczbaPolek}x ${polkiGlebokosc}mm):</strong><br><span style="color: #667eea;">${polkiSurface.toFixed(4)} m²</span></div>` : ''}
                    ${toperWysokosc > 0 ? `<div><strong>Powierzchnia topera 1 (${toperWysokosc}mm):</strong><br><span style="color: #667eea;">${toperSurface.toFixed(4)} m²</span></div>` : ''}
                    ${toper2Wysokosc > 0 ? `<div><strong>Powierzchnia topera 2 (${toper2Wysokosc}mm):</strong><br><span style="color: #667eea;">${toper2Surface.toFixed(4)} m²</span></div>` : ''}
                    <div>
                        <strong>Powierzchnia całkowita:</strong><br>
                        <span style="color: #667eea;">${totalSurface.toFixed(4)} m²</span>
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e1e5e9;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong>Koszt materiału:</strong><br>
                        <span style="color: #2ed573;">${materialPrice.toFixed(2)} zł</span>
                    </div>
                    ${grafikaPrice > 0 ? `<div><strong>Koszt grafiki:</strong><br><span style="color: #ff6b6b;">${grafikaPrice.toFixed(2)} zł</span></div>` : ''}
                    <div>
                        <strong>Cena całkowita:</strong><br>
                        <span style="color: #667eea; font-size: 1.2rem; font-weight: bold;">${totalPrice.toFixed(2)} zł</span>
                    </div>
                </div>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                    Kalkulacja: powierzchnia × 30 zł/m² × grubość (${gruboscPlexi}mm) × mnożnik (2.5) + grafika
                </small>
            `;

            // Update main calculator display
            updateDisplay(totalSurface, materialPrice, 0, grafikaPrice, totalPrice, 0, gruboscPlexi, 0, 0);
        }

    </script>

    <!-- Miejsce na formularz logistyki -->
    <div id="logistics-root" style="margin-top: 40px;"></div>

    <!-- Wczytywanie modułu logistyki -->
    <script type="module" src="./LogisticsFormExtended.js"></script>
<script>
        // Override the existing saveCalculation function
        window.saveCalculation = function(callback) {
            // Validate required fields
            const productType = document.getElementById('productType').value;
            const clientCompany = document.getElementById('client_company').value;
            
            if (!productType) {
                alert('Proszę wybrać rodzaj produktu');
                return;
            }
            
            if (!clientCompany) {
                alert('Proszę podać nazwę firmy klienta');
                return;
            }
            
            // Collect all form data
            const formData = {
                // Product data
                productType: productType,
                material: document.getElementById('materialSelect')?.value,
                thickness: document.getElementById('thicknessSelect')?.value,
                width: document.getElementById('width').value,
                height: document.getElementById('height').value,
                depth: document.getElementById('depth')?.value,
                quantity: document.getElementById('quantity').value,
                
                // Client data - always send client object, server will create if needed
                client: {
                    firma: document.getElementById('client_company').value,
                    nip: document.getElementById('client_nip').value,
                    adres: document.getElementById('client_address').value,
                    kod_pocztowy: document.getElementById('client_postal_code').value,
                    miasto: document.getElementById('client_city').value,
                    telefon: document.getElementById('client_phone').value,
                    email: document.getElementById('client_email').value,
                    osoba_kontaktowa: document.getElementById('client_contact_person').value
                },
                
                // Product details for quotation
                products: [{
                    nazwa: getProductName(),
                    ilosc: parseInt(document.getElementById('quantity').value) || 1,
                    cena_jednostkowa: currentCalculation.productCost / (parseInt(document.getElementById('quantity').value) || 1),
                    wartosc_netto: currentCalculation.productCost,
                    parametry: {
                        productType: productType,
                        material: document.getElementById('materialSelect')?.options[document.getElementById('materialSelect')?.selectedIndex]?.text,
                        thickness: document.getElementById('thicknessSelect')?.value,
                        width: document.getElementById('width').value,
                        height: document.getElementById('height').value,
                        depth: document.getElementById('depth')?.value
                    }
                }],
                
                // Logistics data
                logistics: {
                    packaging_type: document.querySelector('input[name="packaging_type"]:checked')?.value,
                    delivery_type: document.querySelector('input[name="delivery_type"]:checked')?.value,
                    total_weight: parseFloat(document.getElementById('total_weight').textContent),
                    packaging_cost: parseFloat(document.getElementById('packaging_cost').textContent),
                    delivery_cost: parseFloat(document.getElementById('delivery_cost').textContent),
                    logistics_cost: currentCalculation.logisticsCost
                },
                
                // Comments
                uwagi: document.getElementById('handlowiec_comment').value,
                
                // Salesperson data
                handlowiec_name: document.getElementById('salesperson_name').value,
                numer_oferty: document.getElementById('offer_number').value,
                
                // Dates
                data_waznosci: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 30 days from now
            };
            
            // Send to server
            fetch('/api/quotations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('token') || localStorage.getItem('authToken') || '')
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json().then(data => {
                    if (!response.ok) {
                        throw new Error(data.error || `HTTP error! status: ${response.status}`);
                    }
                    return data;
                });
            })
            .then(data => {
                if (data.id) {
                    alert(`Oferta została zapisana!\nNumer oferty: ${data.numer_oferty || data.id}`);
                    
                    // Save logistics data
                    if (formData.logistics.packaging_type) {
                        return fetch(`/api/quotations/${data.id}/logistics`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer ' + (localStorage.getItem('token') || '')
                            },
                            body: JSON.stringify({
                                packagingType: formData.logistics.packaging_type,
                                packagingCost: formData.logistics.packaging_cost,
                                deliveryType: formData.logistics.delivery_type,
                                deliveryCost: formData.logistics.delivery_cost,
                                totalWeight: formData.logistics.total_weight,
                                logisticsCost: formData.logistics.logistics_cost
                            })
                        });
                    }
                } else {
                    throw new Error(data.error || 'Nieznany błąd');
                }
            })
            .then(() => {
                // Optionally clear form or redirect
                if (confirm('Czy chcesz utworzyć nową kalkulację?')) {
                    location.reload();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Błąd podczas zapisywania: ' + error.message);
            });
        }
        
        function getProductName() {
            const productType = document.getElementById('productType').value;
            const productNames = {
                'plyta': 'Płyta standardowa',
                'kaseton': 'Kaseton reklamowy',
                'pojemnik': 'Pojemnik/Organizer',
                'gablota': 'Gablota',
                'obudowa': 'Obudowa/Osłona',
                'ledon': 'LEDON (Neon LED)',
                'ekspozytory': 'Ekspozytor',
                'impuls_kasowy': 'Impuls kasowy z plexi'
            };
            
            let name = productNames[productType] || 'Produkt';
            
            // Add material info
            const materialSelect = document.getElementById('materialSelect');
            if (materialSelect && materialSelect.selectedIndex > 0) {
                name += ' - ' + materialSelect.options[materialSelect.selectedIndex].text.split(' (')[0];
            }
            
            return name;
        }
        
        // Save draft
        function saveDraft() {
            const formData = collectFormData();
            formData.status = 'robocza';
            
            localStorage.setItem('draft_quotation', JSON.stringify(formData));
            alert('Kopia robocza została zapisana lokalnie');
        }
        
        // Save and send
        function saveAndSend() {
            if (!confirm('Czy chcesz zapisać ofertę i wysłać ją do klienta?')) {
                return;
            }
            
            const clientEmail = document.getElementById('client_email').value;
            if (!clientEmail) {
                alert('Proszę podać adres email klienta');
                return;
            }
            
            // First save the quotation
            saveCalculation((quotationId) => {
                // Then send email
                fetch('/api/quotations/' + quotationId + '/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + (localStorage.getItem('token') || localStorage.getItem('authToken') || '')
                    },
                    body: JSON.stringify({
                        to: clientEmail,
                        subject: 'Oferta PlexiSystem - ' + document.getElementById('offer_number').value
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Oferta została wysłana na adres: ' + clientEmail);
                    } else {
                        alert('Błąd wysyłania: ' + (data.error || 'Nieznany błąd'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Błąd wysyłania emaila');
                });
            });
        }
        
        // Collect form data helper
        function collectFormData() {
            return {
                // Product data
                productType: document.getElementById('productType').value,
                material: document.getElementById('materialSelect')?.value,
                thickness: document.getElementById('thicknessSelect')?.value,
                width: document.getElementById('width').value,
                height: document.getElementById('height').value,
                depth: document.getElementById('depth')?.value,
                quantity: document.getElementById('quantity').value,
                
                // Client data - always send client object, server will create if needed
                client: {
                    firma: document.getElementById('client_company').value,
                    nip: document.getElementById('client_nip').value,
                    adres: document.getElementById('client_address').value,
                    kod_pocztowy: document.getElementById('client_postal_code').value,
                    miasto: document.getElementById('client_city').value,
                    telefon: document.getElementById('client_phone').value,
                    email: document.getElementById('client_email').value,
                    osoba_kontaktowa: document.getElementById('client_contact_person').value
                },
                
                // Salesperson data
                handlowiec_name: document.getElementById('salesperson_name').value,
                numer_oferty: document.getElementById('offer_number').value,
                
                // Logistics
                logistics: {
                    unit_carton: document.getElementById('unit_carton_checkbox').checked,
                    packaging_type: document.querySelector('input[name="packaging_type"]:checked')?.value,
                    delivery_type: document.querySelector('input[name="delivery_type"]:checked')?.value,
                    total_weight: parseFloat(document.getElementById('total_weight').textContent),
                    packaging_cost: parseFloat(document.getElementById('packaging_cost').textContent),
                    delivery_cost: parseFloat(document.getElementById('delivery_cost').textContent),
                    logistics_cost: currentCalculation.logisticsCost
                },
                
                // Comments
                uwagi: document.getElementById('handlowiec_comment').value,
                
                // Pricing
                pricing: {
                    product_cost: currentCalculation.productCost,
                    logistics_cost: currentCalculation.logisticsCost,
                    unit_carton_cost: currentCalculation.unitCartonCost || 0,
                    total_netto: currentCalculation.productCost + currentCalculation.logisticsCost,
                    total_brutto: (currentCalculation.productCost + currentCalculation.logisticsCost) * 1.23
                }
            };
        }
        
        // Toggle between cost estimator and client view
        function toggleViewMode() {
            const isKosztorysant = document.getElementById('viewModeToggle').checked;
            
            // Elements to hide in client mode
            const kosztorysantElements = [
                'materialCost',
                'addonsCost',
                'optionsCost',
                'wasteInfo',
                'thicknessInfo',
                'weightInfo'
            ];
            
            kosztorysantElements.forEach(id => {
                const element = document.getElementById(id);
                if (element && element.parentElement) {
                    element.parentElement.style.display = isKosztorysant ? 'block' : 'none';
                }
            });
            
            // Update section titles
            const detailsTitle = document.querySelector('#calculationDetails').parentElement.querySelector('h3');
            if (detailsTitle) {
                detailsTitle.innerHTML = isKosztorysant ? 
                    '<i class="fas fa-info-circle"></i> Szczegóły kalkulacji' : 
                    '<i class="fas fa-info-circle"></i> Informacje o produkcie';
            }
        }
        
        function getSelectedAddonsHTML() {
            const selectedAddons = [];
            
            // Check all addon checkboxes
            document.querySelectorAll('input[type="checkbox"][id^="addon_"]:checked').forEach(checkbox => {
                const addonId = checkbox.id.replace('addon_', '');
                const qtyInput = document.getElementById(`addon_qty_${addonId}`);
                const qty = parseFloat(qtyInput?.value) || 0;
                
                if (qty > 0) {
                    const label = checkbox.parentElement.querySelector('label').textContent;
                    const price = parseFloat(checkbox.getAttribute('data-price')) || 0;
                    const unit = checkbox.getAttribute('data-unit') || 'szt';
                    
                    selectedAddons.push({
                        name: label.split(' - ')[0].trim(),
                        qty: qty,
                        unit: unit,
                        price: price * qty
                    });
                }
            });
            
            if (selectedAddons.length === 0) {
                return '';
            }
            
            return `
                <h4 style="margin-top: 20px;">Usługi dodatkowe:</h4>
                <table style="margin-top: 10px;">
                    <tr>
                        <th>Usługa</th>
                        <th>Ilość</th>
                        <th>Cena</th>
                    </tr>
                    ${selectedAddons.map(addon => `
                        <tr>
                            <td>${addon.name}</td>
                            <td>${addon.qty} ${addon.unit}</td>
                            <td>${addon.price.toFixed(2)} zł</td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }
    </script>
</body>
</html>